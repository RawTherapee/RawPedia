---
title: Wavelets jp
contributors:
  - DrSlony
  - Yz2house
---

<div class="pagetitle">

ウェーブレットのレベル

</div>

<figure>
<img src="/images/Daffodil_split.jpg" title="Daffodil_split.jpg" />
<figcaption>Daffodil_split.jpg</figcaption>
</figure>

__TOC__

## この機能の構成

　ウェーブレット機能は広範囲にわたっていて、その基礎になっているアルゴリズムも複雑です。しかし、補間或いはカラーマネジメントと言った一定の役割を除けば、デジタル写真の処理に必要な機能の殆どを備えています。最も有益な点は、RawTherapeeの他の機能を使って行った処理の完成度を高め、微妙な処理を施すことが出来ることです。分解された画像の各レベルで調整が行えるので、全体的な細部を変えることなく、微妙なコントラストや色の効果の調整、ノイズ除去や不良部分の補正、或いはアーティファクトを発生させずに画像の輝度や色を調整することが可能です。

　この機能はどのジャンルの画像にも利用できますが、特に、微細な部分で選択的な調整が必要な、ポートレート、マクロ写真、天体写真の処理に適しています。もちろん、風景写真に関しても、青空特有のノイズを除去、細部を損なわずにダイナミックレンジを圧縮、シャドウ部分のノイズを軽減、色被りを除去、輝度に特殊な効果を付ける、などを行うことが出来ます。このように処理の可能性は殆ど無限ですが、そのためには貴方がこの機能の原理と操作を十分理解し、適切に処理することが肝要です。

　この機能は、最初に全般的なウェーブレットの設定モジュール、その後に有効・無効を切り替えて使う特定作業のモジュールという形で構成されています。

## ウェーブレットとは？

　[ウェーブレット](http://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A7%E3%83%BC%E3%83%96%E3%83%AC%E3%83%83%E3%83%88)、もっと特定的に言えば、[ウェーブレット変換](http://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A7%E3%83%BC%E3%83%96%E3%83%AC%E3%83%83%E3%83%88%E5%A4%89%E6%8F%9B)は30数年前にJean
MorletとAlex
Grossmanによって開発された関数です。フーリエ変換にかなり近いものですが、標準的なフーリエ変換が画像を全体の周波数で解析するのに対し、ウェーブレット変換は画像をピクセルレベルの周波数で解析するので、精度は高くなります。そのマザー関数に導かれたウェーブレット変換で画像を異なる大きさのディテールで分けた複数のレベルに分解し、それらレベルを個々に調整することが出来ます。その数学的な原理は、Stéphane
Mallatによって開発されました。

　RawTherapeeは内包している色々な機能で、ウェーブレット変換を使っていますが、特にこの“ウェーブレットのレベル”ではそのマザー関数に[ドブシー関数](https://en.wikipedia.org/wiki/Daubechies_wavelet)を使っています。作業色空間に[L\*a\*b\*](https://ja.wikipedia.org/wiki/Lab%E8%89%B2%E7%A9%BA%E9%96%93)を使って、画像を各要素、L\*、a\*、b\*に分解します。

<figure>
<img src="/images/Wavelet_daubechies20.jpg" title="Wavelet_daubechies20.jpg" />
<figcaption>Wavelet_daubechies20.jpg</figcaption>
</figure>

　画像の分解は、ピクセルの集合体（１番目のレベルは2x2=4ピクセル、2番目のレベルは4x4=16ピクセル。。。）のコントラストを3つの方向、垂直、水平、斜めで解析するアルゴリズムを使って行われます。そして、これらコントラスト値の解析結果は異なる振幅と強度値を持つウェーブレットの組み合わせに変換され、係数行列と言う形で保持されます。ウェーブレットで分解した画像を再生する際に、元画像に限りなく近い形にするためです。

　実際は、分解が行われた時点で元画像の存在は無くなり、係数行列（各レベルに１つの）だけが、その後の編集処理に使われます。これら係数行列は以下2通りの方法で画像を特徴付けるために使うことが出来ます：

1.  ディテールの大きさで分かれた複数のレベル：1番目のレベル1は画像を2x2ピクセルの単位で解析したものです、エキストラと呼ぶ10番目のレベルは1024x1024ピクセルの単位で解析したものです。従って、レベルの番手が上がると、処理時間やメモリーの使用量が増加します。各レベルを色相や輝度の“変化量”という係数で解析するため、レベルの画像の輝度と色が完全に均一であれば、そのレベルから得られる解析データはありません。この場合、各レベルの違いは、デジタルノイズ、エッジ効果によるコントラスト（或いは色度）、霞やその他の光学現象に由来するものだけになります。
2.  残差画像：各レベルのデータを合算し、元画像のデータからその合算値を引いた画像です。データ処理の点から言えば、この残差画像も元画像と同じ性質を持っていますが、各レベルに保持されているようなディテールはありません。どのレベルで調整（コントラストや色度など）を行っても残差画像に影響しません（逆もまた然りです）。

　更に、各レベルで係数の組み合わせが解析され、その平均値（各レベルで計算されるのでそれぞれ異なった値になります）及び標準偏差が算出されます。これらに係数の最小値と最大値を加えることで、各レベルのコントラスト特性が得られます（これら特性は\[<https://ja.wikipedia.org/wiki/%E6%AD%A3%E8%A6%8F%E5%88%86%E5%B8%83>　ガウス分布\]ではありません）。以上全てがこの機能の様々なアルゴリズムで使われます。

## 実践

　画像を分解した後、これら画像を様々な目的で使うことが出来ます：画像の圧縮、ノイズ低減処理、シークレット透かし、天体撮影の特殊な残差画像の処理など。

　目的に応じて、単独または複数のレベル、残差画像、或いは、両方の組み合わせで、調整が可能です。

<figure>
<img src="/images/Wavelet_detail_size.jpg" title="Wavelet_detail_size.jpg" />
<figcaption>Wavelet_detail_size.jpg</figcaption>
</figure>

  
  
**1 (最も小さい)** : 2x2ピクセル

**2** : 4x4ピクセル

**3** : 8x8ピクセル

**4** : 16x16ピクセル

**5** : 32x32ピクセル

**6** : 64x64ピクセル

**7** : 128x128ピクセル

**8** : 256x256ピクセル

**9 (最も大きい)** : 512x512ピクセル

**エキストラ** : 1024x1024ピクセル

　分解するレベルの総数が4或いは5、などと少ない場合は、画像の解析単位も最大16x16ピクセル或いは32x32ピクセルに留まります。元画像から引かれるレベルのデータが多くないため、残差画像の映りは元画像と比較的似ていますが、画像編集に役立つ特性は大きくありません。一方、レベルの総数を9やエキストラに設定すると、解析単位が最大512x512ピクセル、1024x1024ピクセルになります。残差画像は著しく変化し、ぼかした背景の様な映りになりますが、この残差画像が編集にとって重要な役割を果たします。

　ウェーブレット変換による分解で、画像は明度(L\*)と補色次元(a\*とb\*)に分解された複数のレベルと一つの残差画像になります。これにより各レベルに対して異なる明るさと色調の調整、そしてそれらとは完全に異なる処理を残差画像に施すことが可能となります。つまり、レベルの画像と残差画像はそれぞれ独立していて、調整の影響を受けるレベルは変更を加えたレベルだけです。残差画像は独立しているので、各レベルの調整に関わらずそれらの影響を受けません。

　注意：“ウェーブレットのレベル”と“[CIE色の見えモデル02](CIECAM02/jp.md)”の機能を併用すると、アーティファクトが発生するかもしれません。これはCIECAMの色空間が、L\*a\*b\*色空間に近いとは言え、異なるからです。コードが異なるのでアーティファクトの発生は物理的に避けられませんが、発生するかどうかは調整次第です。

### プレビュー

　スクリーン上の画像の大きさは、画像のシャープネスや様々な機能の調整による小さな変化に直接的に影響します：**それら変化は画像を100％（或いはそれ以上）に拡大して初めてわかります。**

　これは実際には処理速度の制限（[プレビューエリアの制限を](General_Comments_About_Some_Toolbox_Widgets/jp#プレビューエリアの制限.md)参照）から最終画像のサイズを意識しておく必要があると言う意味です。最終的に画像サイズを縮小する（切り抜きではなく、リサイズのことです）予定であれば、ウェーブレットによる調整を行う前にリサイズしておくことを奨めます。そうでないとプレビューで見る画像と最終的に書き出した画像の映りが違う場合があることを覚えておいて下さい。

　もう一つ別な制約があります：RawTherapeeはプレビューに表示できる全てのレベルを使いますが、貴方がスクリーンで見る画像の部分より大きいディテールを持つレベルは無視します。但し、無視されたレベルに施された調整は画像が保存される際に反映されます：

- 　**例1：**画像の大きさが**4096x2160**ピクセルで、それを100％以上の拡大率で見た時、プレビュー画面で最終画像の大きさに似た**1500x1200**ピクセルで見ることが出来る場合。これは理想的な環境です。全てのレベル（最大のエキストラレベルまで）で行った調整が確認できるからです。加えて、どのレベルでも確認出来た調整効果は最終画像に反映されます。
- 　**例2：**画像の大きさは**4096x2160**ピクセルですが、100％以上の拡大率で見る際のプレビュー画面の画像の大きさが**300x200**ピクセルの場合。上記と異なり、番手が7（128x128ピクセル）より大きいレベルに加えられた調整効果をプレビューで確認出来ません。確認は出来ませんが、それら調整効果は画像を保存する際には反映されています（元画像の大きさが1024x1024ピクセルより大きいからです）。
- 　**例3：**画像の大きさが**720x480**ピクセルで、それを拡大して**300x200**ピクセルのプレビューで見る場合。番手が7（128x128ピクセル）より大きいレベルに加えられた調整効果をプレビューで確認出来ません。画像を保存する際に、番手8（256x256ピクセル）の調整は反映されますが、番手9及びエキストラレベルの調整は**含まれません**（画像が解析単位より小さいからです）

　この制約を認識しておく手立てとして、効果を表示できる最大の番手のレベルをコントラストモジュールの最後のスライダーの後に表示してあります。上記の例2、3で言えば、“プレビューでの最大表示レベル７”というように。

### 詳細レベルによるコントラスト調整とウェーブレットのレベル

　留意として、RawTherapeeには既に“[詳細レベルによるコントラスト調整](Contrast_by_Detail_Levels/jp.md)”という、この“ウェーブレットのレベル”と似た機能がありますが、以下の点が異なります：

1.  詳細レベルによるコントラスト調整は、レベルの総数が6に固定されています。ウェーブレットのレベルは総数を4～10（エキストラ）まで変えられます（デフォルトは7）。
2.  詳細レベルによるコントラスト調整が行えるのは、各レベルの輝度調整だけですが、ウェーブレットのレベルは色度も調整出来ます。
3.  詳細レベルによるコントラスト調整は各レベルの全ての輝度値を均等に調整しますが、ウェーブレットのレベルは輝度値（或いは色度）を漸進的に調整出来ます（更に詳しい説明がコントラストの[減衰の](Wavelets/jp#減衰.md)項にあります）。
4.  詳細レベルによるコントラスト調整には残差画像がありません。

　双方の機能に違いはありますが、併用することは出来ます。但し、以下のことに注意が必要です。詳細レベルによるコントラスト調整は[ツールチェーンパイプラインに](Toolchain_Pipeline/jp.md)示した処理工程全体の中のアップストリームに属しています。一方のウェーブレットのレベルはダウンストリームに属しています。従って、ウェーブレットのレベルを使ってコントラストを調整した後で”詳細レベルによるコントラスト調整”を使うと、先にウェーブレットのレベルで調整した1～6までのレベルの効果が変わってしまいます。双方の機能を併用する際は、詳細レベルのコントラスト調整を先に使うことを奨めます。

## ウェーブレットの設定

### 強さ

　このスライダーで機能の全体的な効果の強さを調整出来ます。GIMPのレイヤーの融合に使われる不透明度に近い原理で作用します：ウェーブレットのレベルの様々な機能を使って行った調整は元画像に融合されるので、初めにある程度強めの調整を行った後、スライダーの値を下げることで、効果の程を微調整することが出来ます。

### レベルの総数

　このスライダーで、画像を幾つのレベルに分解するか設定します。4～9で自由に選べます（エキストラと呼ぶ10番目のレベルは9を設定すると自動的に表示されます）。レベルの数が増えれば、処理時間やメモリー使用量も増えます。

### 解析の領域

　ウェーブレット変換で解析する画像の領域をドロップダウンリストから、画像全体、或いはタイルで選びます。質の点を考えれば、支障がない限り、“画像全体”を使うことを奨めます（タイルを使用した場合の境界の問題を避けるため）。システム（PC）のスペックに限界（例、メモリー容量不足）がある場合、或いは編集画像のサイズが非常に大きい場合に（例、50M以上）、画像の一部だけを対象とするタイルを使います。

　適用が“画像全体”で、レベルの総数を9に設定した場合に必要なメモリー量（MiB：メビバイト）を、2つのカメラを例にとって説明します：

| 必要なメモリー（Mib：メビバイト）、レベルの総数9 |
|--------------------------------------------------|
|                                                  |
| 解像度（Mpx）                                    |
| 画像を開く(全ての機能はオフ状態)                 |
| コントラスト、色度、或いは色相保護を調整         |
| 色ずれを回避を追加                               |
| 合計                                             |

### エッジ検出の効力

　ウェーブレットのレベルはウェーブレット変換のマザー関数に、ドブシーを使っています。この関数は最大10個の尺度係数を使う多種に分かれており、D2という種類はハール（Haar）のウェーブレット変換と同等です。種類はD20と呼ばれるものまでありますが、RawTherapeeでは、D2（ハール）、D4（標準）、D6
（標準プラス）、D10（やや高度）、D14（高度）を使っています。係数が増えるほど、ウェーブレット変換が区別できるディテールも増えますが、処理時間も若干増えます。但し、通常は無視できる範囲です。

　尺度係数の数と画像の仕上がり（元画像にもよりますが）に直接的な関係はありませんが、適切な係数を選択することで、番手の低いレベルの質を上げるための微調整、或いは残差画像の調整が向上します：

- 　画像によってはD2によるエッジ検出の質が最も良くなることがあります
- 　他のケースでは、D6或いはD14が最良の結果になるでしょう

　このパラメータの選択は後述する“[エッジ検出](Wavelets/jp#エッジ検出.md)”の質にかなり影響します。また、全体的な分解の効果（残差画像と各レベル画像の関係）にも影響します。

### プレビューに適用する背景とプロセス

　これらの設定は、ウェーブレットの機能がどの様に働いているかを確認するためのもので、以下に続く様々なモジュールで微細な調整（例：ノイズ低減）を行う時の助けになります。

　合計で4つのドロップダウンリストがあり、プレビューで見極める目的に応じて選択します。初めの2つがメインのリストです（後のリストはメインリストの選択に応じて有効になります）。

- 　最初のリストはプレビューの背景を選択するものです
- 　次のリストはどのレベルを表示するか選択するものです

#### 背景

　背景はどのレベルを見る場合にも、黒、グレー、残差画像の3種類から選びます。

　選択した背景色に応じてヒストグラムも変わるので、例えば、残差画像の設定効果を確認したい場合に、ヒストグラムを参考にしながら調整を行えます。しかし、背景に黒やグレーを選択すると残差画像（画像本来の背景）を見ることは出来ません。非現実的な映りなので、レベルに行った調整の効果を実際の画像上で見極める場合には、残差画像を背景に戻さなければ出来ません。それでも、背景を黒やグレーで見るオプションが付いているのは、調整を行うとどの様な変化が起こるのか（例えばノイズ低減）見ることが編集の参考になると思われるからです。

#### プロセス

　4つの表示方法から選びます：

1.  　特定の番手のレベルの画像だけを表示
2.  　選択したレベルの番手**以下**のレベル全て（小さいディテール）を融合した画像を表示
3.  　選択したレベルの番手**より**上のレベル全て（大きいディテール）と残差画像を融合した画像を表示
4.  　全てのレベルと残差画像を全ての方向で融合した画像を表示（デフォルト）

　上記の1～3を選択すると、最後の2つのドロップダウンリストが有効になります。

- 　左側のリストで、上記1～3のオプションで使うレベル（1～9）、或いは残差画像の選択をします。
- 　右側のリストで、ウェーブレットによる分解に適用するピクセルの方向を、垂直、水平、斜め、全ての方向、から選択をします。

　“全てのレベルを全ての方向で融合した画像を表示”を選ぶと、残差画像を含めた画像のままレベルを編集出来ます（このオプションを選択すると、上記2つのリストは無効、グレーアウト、になります）。既にウェーブレット機能を使った調整に経験があるユーザーなら、画像全体の仕上がりを見極めながら編集する方が扱いやすいかもしれません。また、このオプションは**最終画像をエクスポート（保存）する時には常に選択しておく必要があります。**プレビューに映し出されている画像が最終画像としてエクスポートされるので、前述のようにプレビューの表示を特定のレベルだけ、或いは番手の低いレベルだけを融合したまま、エクスポートすると、非現実的な映りの画像が保存されることになるので注意して下さい。

#### 使い方のヒント

- 　“特定レベルだけを表示”を選び、背景をグレーにすれば、エッジ検出の効力を設定するドブシー関数の係数（D2～D14）の選択で、ディテールがどの様に分解されるのか見ることが出来るので、どの係数を選んだ際に最も正確なディテールの区別ができるかを見極められます。
- 　“特定レベルだけを表示”を選び、目標とする調整を行うレベルの番手を見極めます（例えば、肌のきめを変えずにシミだけを目立たなくするために、どのレベルを調整するのが適当か）。
- 　“特定レベルだけを表示”1番目を選び、特定のレベルのコントラスト調整効果やノイズ低減の効果を見極めます。
- 　3番目の表示方法を選ぶと、残差画像と番手の大きいレベル（大きいディテール）を合わせた画像を見ることが出来るので、残差画像モジュールの様々な調整機能を使った効果を確認出来ます。
- 　2番目の表示方法を選び、背景を残差画像にすれば、大きいディテールのレベルの効果を排除できるので、細かい部分の調整をより正確に見極めることが出来ます。

#### 実例

　以下の画像は、最小限の調整（レベルの総数は5、**エッジ検出の効力**はD6）を行った参考画像で、本解説の後半でもこれら画像を使って説明が行われています。左から、元画像、レベル2だけを表示した画像（**背景**：グレー）、レベル4だけを表示した画像（背景グレー）、残差画像だけを表示した画像。

<span style="font-size: 0.7em; font-style: italic;">  ***画像を拡大するには画像をクリックします。更にクリックすると画像だけが表示されます***.
</span>

<div>

- <figure>
  <img src="/images/wavelet_pic.jpg" title="wavelet_pic.jpg" />
  <figcaption>wavelet_pic.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_config_L2.jpg" title="wavelet_config_L2.jpg" />
  <figcaption>wavelet_config_L2.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_config_L4.jpg" title="wavelet_config_L4.jpg" />
  <figcaption>wavelet_config_L4.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_config_RI.jpg" title="wavelet_config_RI.jpg" />
  <figcaption>wavelet_config_RI.jpg</figcaption>
  </figure>

</div>

## コントラストのモジュール

　この調整モジュールで、ディテールの輝度（L\*）コントラストをレベルごとに調節することが出来ます。大きいディテールのレベルのコントラストを減らす一方で、小さいディテールのレベルのコントラストを増やし、画像全体のシャープネスを高めることが出来ます。実際の編集では、大きいディテールのレベルのコントラストを下げれば、小さいディテールのレベルのコントラストを大きく上げなくても、シャープネスが得られるということで、ハロなどのアーティファクトの発生を避けられるメリットがあります。

### 減衰

　冒頭の方でも説明していますが、この機能は分解した各レベルのコントラストの平均値と標準偏差も計算します。それらはこのモジュールのあらゆる機能で使われます。

　コントラストモジュールで、最初に行う操作は各レベルのコントラストを変えることですが、この操作だけではそのレベルのコントラスト全体が元のコントラストに対して線形的（均等）に増減するだけなので（“詳細レベルによるコントラスト調整”の\[<https://ja.wikipedia.org/wiki/%E8%A1%8C%E5%88%97%E3%81%AE%E7%9B%B8%E4%BC%BC>　相似変換\]のように）、アーティファクトの発生がままあります。

　この問題に対処するため、コントラスト調整を行う前に、各レベルのディテールのコントラストを解析し、コントラスト値が以下の概念図のような漸進的な分布になるように並べ替えます。

<figure>
<img src="/images/Wavelet_beta.png" title="Wavelet_beta.png" />
<figcaption>Wavelet_beta.png</figcaption>
</figure>

　各レベルのコントラスの分布は概ね以下のようになっています:

- 左がコントラスト値の低い部分で、右がコントラスト値の高い部分です
- 各レベルのスライダーで設定されるコントラストの値は、各コントラスト値に適用される最大値です。
- 最も多くのコントラスト値が増加する（或いは減少）するのは平均値に近いコントラスト値です。
- 平均コントラストから離れるほど、調整の影響を受けるコントラスト値の数は少なくなります。
- 高いコントラスト値の方が、低いコントラスト値より増減幅が大きくなります。

　つまり、コントラストの変化が最も大きくなるのは各レベルの中間コントラストで、両端の極端なコントラストが過剰に変化してアーティファクトが発生することを避けられます。しかし、2つの根本的な要点を理解しておく必要があります:

1.  平均コントラストの値とは、そのレベルのコントラスト値から算出した値です:そのレベルのコントラスト値全体が高ければ、その平均値も高くなります。しかし、極端なコントラスト値の変化は大きくありません。
2.  各レベルで、ディテールのコントラストの平均値は異なります。

### コントラストのレベル

　![](Wavelet_contrast_buttons.jpg "Wavelet_contrast_buttons.jpg")
これらスライダーに表示されたレベルの数字は、ウェーブレットの設定の“[レベルの総数](Wavelets/jp#レベルの総数.md)”で定義されたもので、設定次第で表示が変わります。

　**コントラスト+**と**コントラスト-**ボタンで、コントラストを簡単に漸進的に変えることが出来ます。つまり、番手の低いレベルのスライダーほど増加/減少の幅が大きく、高いレベルほど小さな幅で動きます。但し、この設定スタイルは一般的に番手の低いレベルの加減としては適当ですが、画像の完成度を高めるためには番手の高いレベル（7～エキストラ）の値をネガティブにする（高いレベルのコントラストを減らす）こともよくあるので、その場合は好みに合わせて該当するスライダーを調整します。

　但し、コントラストが均一なレベルでは、そのレベルに対するスライダーによる調整は何の効果も生みません。

　また、一連のレベルのスライダーに残差画像は含まれません。残差画像はレベルの画像とは異なるからです。残差画像はレベル全てのデータを元画像から減算したものです。

### コントラストの減衰と選択

　前述のコントラストの解析で説明したように、調整を行うためのスライダーが3つあります:

1.  　**減衰応答：**プラスにすると、中間コントラスト値の分布（カーブの上部）が広がりますが、コントラスト値の高い方がより大きく広がります。反対にマイナスに調整をすると、カーブの幅が狭くなり、大きな変化を受けるコントラスト値の範囲が狭まります。図で見ると:
    <div>

    - <figure>
      <img src="/images/Wavelet_beta%2Bdamper.png"
      title="Wavelet_beta%2Bdamper.png" />
      <figcaption>Wavelet_beta%2Bdamper.png</figcaption>
      </figure>

    - <figure>
      <img src="/images/_Wavelet_beta-damper.png" title="_Wavelet_beta-damper.png" />
      <figcaption>_Wavelet_beta-damper.png</figcaption>
      </figure>

    </div>
2.  **オフセット：**スライダーを移動するとカーブ上部の位置が変わり、最も大きく変化するコントラストが平均コントラスト付近ではなくなります。スライダーを右に動かすと、平均より高いコントラストの変化が最も大きくなり、左に動かすと低いコントラストの変化が最も大きくなります。図で見ると:
    ![](Wavelet_beta%2Boffset.png "Wavelet_beta%2Boffset.png")
3.  **最小コントラストのしきい値：**調節を行う際のディテールのコントラストの最小値を決めるスライダーです。ここで設定される値が最小のコントラスト値として計算上考慮されます。最初の2つのスライダーの設定に関わらず、最小値以下のコントラストは調節に考慮されない、或いは調節の影響を受けません。これによりノイズが目立つことを避けたり、より繊細な質感を調整したりします。

### “適用”の説明

　この機能で、各レベルのコントラスト調整を、輝度範囲全体で適用するか、或いは指定した輝度範囲だけで適用するか決めます。これにより、例えば、番手の低い（小さいディテール）レベルのコントラスト調整は輝度の高い範囲だけ、番手の高い（大きいディテール）レベルは輝度の低い範囲だけでコントラストを調整することが出来ます。

　ドロップダウンリストで“輝度範囲全体”か、“指定した輝度範囲”（デフォルト）を選びます。

#### 調整の輝度範囲

　輝度範囲全体を選択した場合、各レベルの全ての輝度範囲においてコントラストが変わります。指定した輝度範囲を選択した場合は、指定された輝度範囲のコントラストだけが変わります。従って、シャドウとハイライトのコントラストを同時には調整出来ません。

　指定した輝度範囲を選択した場合は、輝度範囲を決めるしきい値カーブとその輝度範囲を適用するレベルを設定するスライダーが表示されます。

- **番手の低い（ディテールの小さい）レベルの調整に適した輝度範囲**
  - しきい値カーブの節点（4つ）で囲まれた内側が、コントラスト調整の作用が働く部分です。

　　　![<File:Wavelet> contrast
highlight.jpg](Wavelet_contrast_highlight.jpg "File:Wavelet contrast highlight.jpg")

- - カーソルを何れかの節点に合わせると、4つ節点全ての値が表示されます。デフォルトでは左下が50、左上が75、右上が98、右下が100に設定されています。
  - これらの値はコントラスト調整の作用が働く範囲の輝度値を表しています。
  - 輝度値が75～98の範囲で、コントラスト調整が100％作用します。
  - 輝度値が0～50の範囲では、コントラスト調整は作用しません。
  - 輝度値が50～75と98～100の範囲では、コントラスト調整が線形的（徐々に増減）に作用します。
- **調整を行う小さいディテールのレベルの範囲を決めます。**スライダーで設定した数値以下の番手のレベルが上記のしきい値（輝度範囲）に従って調整されます。
- **番手の高い（ディテールの大きい）レベルの調整に適した輝度範囲**
  - 小さいディテールのレベルと同じ特性を持つしきい値カーブがあります。各節点の輝度値はデフォルトで、左下が0、左上が2、右上が25、右下が50に設定されています。
  - 輝度値が0～2の範囲では、コントラスト調整が線形的（徐々に増加）に作用します。
  - 輝度値が2～25の範囲では、コントラスト調整が100％作用します。
  - 輝度値が25～50の範囲では、コントラスト調整が線形的（徐々に減少）に作用します。
  - 輝度値が50以上の範囲では、コントラスト調整は作用しません。
- **調整を行う大きいディテールのレベルの範囲を決めます。**スライダーで設定した数値より上の番手のレベルが上記のしきい値（輝度範囲）に従って調整されます。

　レベル（番手の範囲）を決める2つスライダーで設定した範囲のどちらにも含まれない番手のレベルは、コントラスト調整が行われません（たとえ、そのレベルのコントラストスライダーが調整されていても）。

#### 実践

- レベルの総数が7、レベル7のディテールのコントラストだけを、ディテールの大きいレベルの調整に適した輝度で調整したい場合：レベルの範囲は7に設定します。
- レベルの総数が7、小さいディテールのレベルだけを個々に調整する場合：レベルの範囲を調整したいレベルの最大番手（例、レベル3）に設定して調整を行ない、他のレベルのコントラスト調整スライダーは0にします。
- レベルの総数が7、番手の低いレベルに適した輝度範囲でレベル1と2を、番手の高いレベルに適した輝度範囲でレベル6と7だけを調整する場合：小さいディテールのレベルの範囲を2、大きいディテールのレベルの範囲を6にします。これでレベル1、2、６、7がそれぞれの輝度範囲で調整されます。レベル3、4、5は調整されません。

### 効果の実例

　以下、コントラスト調整による効果の様子を示します。左が元画像で、他の画像は**コントラスト+**ボタンを15回押して（レベル1の数値が135になります）、全てのレベルでコントラストを増やしています。

　左から2番目の画像は、“適用”で**全輝度範囲**を選択した画像です。3番目の画像は**指定した輝度範囲**（しきい値カーブの節点はデフォルトの節点です）を適用した画像です。最後の画像は“ウェーブレットの設定”の**強さ**を50にして、全体の効果を半分に減らした画像です。

<div>

- <figure>
  <img src="/images/Wavelet_pic.jpg" title="Wavelet_pic.jpg" />
  <figcaption>Wavelet_pic.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_WL.jpg"
  title="Wavelet_contrast_15C%2B_WL.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_WL.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6.jpg"
  title="Wavelet_contrast_15C%2B_H3S6.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6_Str50.jpg"
  title="Wavelet_contrast_15C%2B_H3S6_Str50.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6_Str50.jpg</figcaption>
  </figure>

</div>

　元画像と最終画像を並べて比較します、細かい部分の違いを観察して下さい。全体的な仕上がりを損ねずに、花びらのテクスチャーのシャープネスだけが向上しています。

<div>

- <figure>
  <img src="/images/Wavelet_pic.jpg" title="Wavelet_pic.jpg" />
  <figcaption>Wavelet_pic.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/_Wavelet_contrast_15C%2B_H3S6_Str50.jpg"
  title="_Wavelet_contrast_15C%2B_H3S6_Str50.jpg" />
  <figcaption>_Wavelet_contrast_15C%2B_H3S6_Str50.jpg</figcaption>
  </figure>

</div>

## 色度のモジュール

　このモジュールはコントラストのモジュールと似たような働きをします。但し、この機能は色のコントラスト（補色次元a\*とb\*）に作用します。

　調整の方法のドロップダウンリストには以下のオプションがあります：

1.  　**全ての色：**このオプションを選択すると、コントラスト調整を行ったレベルに関係なく、どのレベルに対する調整でも全ての色度が影響を受けます。
2.  　**明清色（パステルカラー）/純色：**コントラスト調整を行ったレベルに関係なく、明清色と純色に分かれた2つのしきい値スライダーで各レベルの色度を調整出来ます。
3.  　**コントラストレベルにリンクさせる：**色度の調整がコントラスト調整に直接的に影響します。

　全ての色、或いは明清色/純色のオプションを選択した場合、リセットボタンを押すと、全てのスライダー値がデフォルト（0）に戻ります。

　更に、どのオプションを選択しても、[減衰の](Wavelets/jp#減衰.md)調整が出来ます。コントラスト調整の同じ働きをします。

### 全ての色度

　このオプションを選択すると、各色の飽和度に関わらず、画像の全ての色の色度が変化します。

　コントラストの冒頭の説明同様、色度の調整が可能なのは、そのレベルに色の変化が存在する場合だけです。そのレベルの色が均一である場合は、調整の効果はありません。

　各レベルの色度の調整範囲は-100～+100です。-100の場合は、そのレベルの色度が完全に失われた状態です。+100はそのレベルの色度が増えた状態ですが、その様な強い調整を行うと殆どの場合アーティファクトが発生するでしょう。それは、このオプションが各ディテールの初期の色の飽和度を考慮しないで調整を適用するからです。

<div>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6.jpg"
  title="Wavelet_contrast_15C%2B_H3S6.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_WC_full.jpg"
  title="Wavelet_chrom_WC_full.jpg" />
  <figcaption>Wavelet_chrom_WC_full.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_WC_L1L2full.jpg"
  title="Wavelet_chrom_WC_L1L2full.jpg" />
  <figcaption>Wavelet_chrom_WC_L1L2full.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_WC_detail.jpg"
  title="Wavelet_chrom_WC_detail.jpg" />
  <figcaption>Wavelet_chrom_WC_detail.jpg</figcaption>
  </figure>

</div>

　上記の説明から分かるように、このオプションを選択した場合は、調整を適用するレベルとその強さ次第で簡単にアーティファクトが発生してしまうので、調整を控えめ行うことが肝要です。但し、あまりに調整が弱いと効果が分かりません。また、このオプションの場合、全ての色ノイズが影響を受けて増加するので注意が必要です。

### 純色/明清色（パステルカラー）

　このオプションを選択すると、各レベルの色の調整が、ディテールの小さい番手の低いレベルでは純色に、ディテールの大きな番手の高いレベルでは明清色に作用します。

　オプションを有効にすると、1つのしきい値スライダーと、2つのしきい値カーブが表示されます。各操作はコントラスト調整の場合と同じです。

- 　**純色/明清色**
  - 　このスライダーで、どのレベルから色度の調整を純色から明清色に切り替えるか設定します。
  - 　デフォルト値は5です。この場合、最初の5つのレベルで純色の色度が、その後のレベルで明清色の色度が調整されます。
  - 　注意：スライダーの設定値が、設定されているレベルの総数を上回っている場合は、純色の色度だけが調整されます。
  - 　反対に設定値が1（最も小さいディテールのレベル）の場合は、1以外のレベルの明清色の色度だけが変わります。
- 　**明清色の色度の定義**
  - 　しきい値カーブはコントラスト調整のものと同型で、4つの節点で色度の調整作用を受ける明清色を定義します。![<File:Wavelet>
    chrom
    pastel.jpg](Wavelet_chrom_pastel.jpg "File:Wavelet chrom pastel.jpg")
  - 　カーブの左側の暗いグレーの部分が明清色で、明るいグレーの部分が純色に相当します。（\[<https://en.wikipedia.org/wiki/Colorfulness>　彩度の説明\]）
  - 　各節点のデフォルト値は、左下が0、左上が2、右上が20、右下が30です。
  - 　各節点の調節はコントラスト調整の場合と同じです。
- 　**純色の色度の定義**
  - 　しきい値カーブの各節点のデフォルト値は、左下が30、左上が45、右上が100、右下が130です。![<File:Wavelet>
    chrom
    chrom.jpg](Wavelet_chrom_chrom.jpg "File:Wavelet chrom chrom.jpg")
  - 　留意：色度は（a\*の二乗 +
    b\*の二乗）の平方根で求められますが、実際の計算値は範囲が非常に広いため、プログラムの動作・効率を考え、敢えてその範囲を0～130に限定してあります。実質的にはこれで十分です。
  - 　節点の値を見ると明清色のしきい値カーブと純色のしきい値カーブはオーバーラップしていませんが、インターフェース上ではオーバーラップしている様に見えます。実際には、しきい値の付近では、純色、明清色の両方が作用の影響を受けるからです。調整作用が明清色に働いているか、純色に働いているか、効果をはっきり見極めるためには、色度スライダーで極端な数値を設定する必要があるでしょう。

　とは言え、全ての色の調整と同様、明らかにアーティファクトが目立つ様な極端な調整を行わない限り、しきい値の付近の効果の違いは無視できる程度のものでしょう。

<div>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6.jpg"
  title="Wavelet_contrast_15C%2B_H3S6.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_WC_L1L2full.jpg"
  title="Wavelet_chrom_WC_L1L2full.jpg" />
  <figcaption>Wavelet_chrom_WC_L1L2full.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_SP_L1L2full_L3_60.jpg"
  title="Wavelet_chrom_SP_L1L2full_L3_60.jpg" />
  <figcaption>Wavelet_chrom_SP_L1L2full_L3_60.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6.jpg"
  title="Wavelet_contrast_15C%2B_H3S6.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6.jpg</figcaption>
  </figure>

</div>

　上記の画像から分かる様に、幾つかのレベルで調整値を最大に設定しているにも関わらず、違いはごく僅かで、注意して観察しないと気付かないでしょう。最も大きな変化は、花びらの静脈の色が少し濃くなったことでしょう。

### コントラストのレベルとのリンク

　このオプションは、各レベルの色度調整をコントラストモジュールで行ったレベルの調整と直結させる機能(クロマリンク)です。

　両レベルを直結させる比率は、**色度とコントラストをリンクさせる強さ**のスライダーで調整します：従って、スライダーの値が0の場合は色度に変化はありません。100の場合は色度の変化が最大になります。変化は“全ての色”のオプションを選択した場合より強くなります（特に色ノイズ）。

　強いコントラスト調整を行っていた場合、色度の変化も大きく、殆どのケースで望ましくないアーティファクトが発生するでしょう：仕上がりが台無しになるようなアーティファクトの発生を避けるために、“色度とコントラストをリンクさせる強さ”のスライダーでリンクさせる比率を調整する際は、徐々に比率を上げるようにします。

### 色度の調整例

<div>

- <figure>
  <img src="/images/Wavelet_chrom_Link_100.jpg"
  title="Wavelet_chrom_Link_100.jpg" />
  <figcaption>Wavelet_chrom_Link_100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_Link_50.jpg"
  title="Wavelet_chrom_Link_50.jpg" />
  <figcaption>Wavelet_chrom_Link_50.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_chrom_Link_50_Str50.jpg"
  title="Wavelet_chrom_Link_50_Str50.jpg" />
  <figcaption>Wavelet_chrom_Link_50_Str50.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_contrast_15C%2B_H3S6.jpg"
  title="Wavelet_contrast_15C%2B_H3S6.jpg" />
  <figcaption>Wavelet_contrast_15C%2B_H3S6.jpg</figcaption>
  </figure>

</div>

　左の画像はコントラストと色度の調整により、花びらの淵が青くなり、雄しべの先端のハロと背景のノイズが目立ちます。しかし、これは調整による効果をはっきりと見せるため、あえて過度の調整を行った参考画像なので、むしろ、花脈の印影を濃くするような微妙な調整が可能であることに注目して下さい。

## 色域のモジュール

　このモジュールはコントラストと色度のモジュールにリンクしています。従って、これをディテールの色度に応じた機能とした目的で使うことが出来ます。言い換えると、各ウェーブレットのレベルのディテール調整で、輝度のコントラスト（コントラストモジュール）や色調のコントラスト（色度モジュール）を考慮するだけでなく、調整を適用する色の範囲も選択することが出来ます。

### 青空のアーティファクトを軽減

　青空が入ったデジタル画像にはスペックルノイズが現れることがままあります。ウェーブレット変換による処理はローカルコントラストを増やす作用があるので、このスペックルノイズが目立つようになったり、細かいアーティファクトが発生したりします。

　このチェックボックスを有効にすると\[<https://en.wikipedia.org/wiki/Median_filter>　メディアンフィルタ\]が働き、これらアーティファクトを軽減します。素早く、且つ、複雑な処理を必要としない、便利な機能ですが、その代わりに色調が変更された部分やコントラストの高い部分で、ディテールが犠牲（損失）になったり、別なアーティファクトが発生したりすることがあります。しかし、これらデメリットは、ディテールタブの“[ノイズ低減や](Noise_Reduction/jp.md)、このウェーブレットのレベルの[ノイズ除去とリファインと](Wavelet_Levels/jp#ノイズ除去とリファイン.md)併用することで改善することが出来ます。

<div>

- <figure>
  <img src="/images/Wavelets_gamut_nosky.jpg" title="Wavelets_gamut_nosky.jpg" />
  <figcaption>Wavelets_gamut_nosky.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_gamut_sky.jpg" title="Wavelets_gamut_sky.jpg" />
  <figcaption>Wavelets_gamut_sky.jpg</figcaption>
  </figure>

</div>

### 肌色の色相

　この解説のタイトルは肌色になっていますが、どの様な色相範囲も目標に出来ます。特定した範囲はモジュール内の他の機能を使って行われる調整に適用されます。デフォルトでその範囲が肌色に指定されているに過ぎません。

　以下に示したしきい値カーブの例は、指定範囲を赤に設定したものです（後述の画像例で効果の違いをはっきり見せるため、限定的に設定しています）。

<figure>
<img src="/images/Wavelets_gamut_skin_hue.jpg"
title="Wavelets_gamut_skin_hue.jpg" />
<figcaption>Wavelets_gamut_skin_hue.jpg</figcaption>
</figure>

### 肌色の目標と保護

　これはディテールのコントラストや上記のカーブで特定した色相の色度、或いはその両方を調整するスライダーです：

- 　スライダーの値が0の時は、画像の全ての色度が均等に調整されます。
- 　スライダーの値が-100の時は、特定した色相範囲でコントラストと色度が調整されます。
- 　スライダーの値が+100の時は、特定された色相範囲以外の色度が調整されます。

　スライダーの値が0と±100の間にある時は、前述の調整が漸進的に進みます。

<div>

- ![](Wavelets_gamut_skin.jpg "Wavelets_gamut_skin.jpg")\]

- <figure>
  <img src="/images/Wavelets_gamut_skin_target0.jpg"
  title="Wavelets_gamut_skin_target0.jpg" />
  <figcaption>Wavelets_gamut_skin_target0.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_gamut_skin_target-100.jpg"
  title="Wavelets_gamut_skin_target-100.jpg" />
  <figcaption>Wavelets_gamut_skin_target-100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_gamut_skin_target%2B100.jpg"
  title="Wavelets_gamut_skin_target%2B100.jpg" />
  <figcaption>Wavelets_gamut_skin_target%2B100.jpg</figcaption>
  </figure>

</div>

### 色相カーブ

　色相の目標と保護を設定した後、このフラットカーブを利用して各色相のコントラストと色度の変化を微調整出来ます：コントロールポイントを上げると該当する色相の色度が増えます、下げれば色度が減りますが完全になくなることはありません。

　但し、カーブによる作用は、先の色相の目標と保護で行った設定が考慮されます。

<div>

- <figure>
  <img src="/images/Wavelets_gamut_curve_target100.jpg"
  title="Wavelets_gamut_curve_target100.jpg" />
  <figcaption>Wavelets_gamut_curve_target100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_gamut_curve.jpg"
  title="グリーン以外の色相のコントラストと色度が下がる様に設定したフラットカーブ" />
  <figcaption>グリーン以外の色相のコントラストと色度が下がる様に設定したフラットカーブ</figcaption>
  </figure>

</div>

### 色ずれの回避

　ウェーブレットのレベルによる処理は画像の色相を大きく変えます、特に作業色空間の極値付近で大きく変わります。このオプションを使うことで、色相が元画像のそれと大きく乖離するのを補正します。

## カラートーンのモジュール

　このモジュールは必要に応じて、特定のレベルのカラートーン調整を行う機能です。

　しかしながら、各レベルはウェーブレット変換により既に補色次元a\*とb\*に分解されてしまっているので、各レベルの色相を直接的に調整することが出来ません。更に、色相の調整と分離された補色次元を数学的に対応させるのも非常に困難です。

　それでも、ある程度は色相をコントロールして色を調整することが可能です。

　他のモジュールと同様、このモジュールにも減衰応答機能が付いています。

### カラートーン調整からの保護

　以下のカラーグリッドはL\*a\*b\*色空間で使われる座標を使った色分布をベースにしています：横軸は補色次元a\*（グリーンからレッドに至る）、縦軸は補色次元b\*（ブルーからイエローに至る）を表しています。

　しかし、実際にL\*a\*b\*色空間を2次元で表現するのは非常に複雑なため、インターフェース上は明清色（パステルカラー）の陰影で表現しています。数学的には正確ですが、視覚的には、特にイエローを選択した場合のカラートーン調整は、直感的に分かり難いと思います。知覚的には以下の様なグリッドになります：

<figure>
<img src="/images/Cielab_8x8.jpg" title="Cielab_8x8.jpg" />
<figcaption>Cielab_8x8.jpg</figcaption>
</figure>

　グリッドの中心にある白点を動かすと、自動的に黒点が中央に表示されます。これら2点はこの後このモジュールで調整されるカラートーン調整から保護される色相の中心部分を定義しています。白点を特定の色に移動すると、最初の色相範囲の中心点が決定します。黒点は2番目の色相範囲の中心点ですが、初めの位置（グリッドの中心）から移動されなければ、この色相範囲の設定は無視されます。

　**aとbの範囲％**のスライダーは、グリッド上で移動された点を中心に、スライダーの値に応じた大きさの保護される色相領域を作成します。

　**保護**のスライダーは、aとbの範囲％のスライダーで定義された保護される範囲で、色相調整の効果を減らします。このスライダーの値は保護効果の強さを表していて、中心点から離れると、徐々にその強さは弱まり、定義された色相領域の最も外側で保護の強さは半分になります。

　例えば、保護のスライダーの値を80に設定すると、保護範囲の中心では、後述するイコライザモジュールで設定したカラートーン調整の20％分しか反映しません。しかし、中心から離れた部分は、aとbの範囲％で設定された保護領域の周辺部分に向かって、設定された値の半分（最大）に達するまで漸進的に強くなります。この例で言えば、調整範囲の周辺部分で保護効果の強さは40になります。つまり周辺部ではカラートーン調整の60％が反映されることになります。

### カラートーン調整

　この調整にはカーブが2つ備わっています。

- 　レッド/グリーン（補色次元a\*）の不透明度
- 　ブルー/イエロー（補色次元b\*）の不透明度

　注意：最終的な画像の色は2つのカーブの組み合わせで決まることを忘れないように。例えば、a\*のカーブ（レッド/グリーンの不透明度）でレッドの方向に調整を行うと、調整するレベルの全てのカラートーンでレッドが強くなりますが、必ずしもレッドそのものになる訳ではありません。もし、画像の中に強いブルーの要素があれば、その色はマゼンタ/バイオレットに近くなります。

　実践的な観点から言えば、カラートーンは一定の制限に向かって、彩度がある程度上がりますが、同時に色相が変化すると言った印象です。これらの効果をより視覚的に捉えるために、b\*を縦軸、a\*を垂直軸に取った[L\*a\*b\*色空間](https://upload.wikimedia.org/wikipedia/commons/0/06/CIELAB_color_space_top_view.png)を上から見てみます。正面から見た\[<https://upload.wikimedia.org/wikipedia/commons/7/7d/CIELAB_color_space_front_view.png>　この色空間\]も忘れずに。上から見た画像の下の部分と、正面から見た同じ部分が一致しているのが分かります。

　それぞれ不透明のカーブは2種類あります；リニア![<File:Wavelet> toning
linear.jpg](Wavelet_toning_linear.jpg "File:Wavelet toning linear.jpg")とイコライザ![<File:Wavelet>
toning
curve.jpg](Wavelet_toning_curve.jpg "File:Wavelet toning curve.jpg")です。アイコン右の▽を押して、どちらかのカーブを選択します。

　リニアカーブを選択すると補色次元a\*、b\*に対する効果はありません。

　各イコライザカーブは横軸(X)と縦軸(Y)を持っています（デフォルトのカーブはフラットで、中間に位置しています）：

- 　X軸は左から右に向かって均等な間隔で並べられた10個のレベルを表しています。
- 　Y軸は調整の強さを表しています：カーブを中央線に対して上下させることで、色は補色次元（a\*或いはb\*）の要素に向かって調整されます。
- 　レッド/グリーン（補色次元a\*）の不透明度カーブでは、カーブを上に動かすと画像の赤味が増え、下に動かすと緑味が増します。
- 　ブルー/イエロー（補色次元b\*）の不透明度カーブでは、カーブを上に動かすと画像の黄味が増え、下に動かすと青味が増します。

　
カーブの調整を初めからやり直す場合は、![<File:ResetButton.png>](ResetButton.png "File:ResetButton.png")をクリックすれば、初期の状態に戻ります。

　元画像の色にコントラストがある限り、上記2つのカーブで、目標とするディテールのカラートーンを調整することが可能です。調整結果は、カーブ上のコントロールポイントの位置（調整するレベルの選択）や調整の強さの設定次第で変わります。以上の操作は見た目で行います。X軸にレベルの番手は表示されませんが、調整が行われるとプレビューでその変化を確認出来ます。

　初期設定でレベルの総数を10以下に設定した場合、調整ポイントの設定で最も右側に相当するレベルは無視されます：仮にレベル総数4で画像を調整した場合、番手が5以上のレベルは無視されます。

### カラートーン調整の例

　不透明度のカーブを使ってカラートーンを調整した例を挙げます。本例では、効果を見せるため**カラートーン調整からの保護**は適用していません：

<div>

- <figure>
  <img src="/images/Wavelet_chrom_Link_50_Str50.jpg"
  title="Wavelet_chrom_Link_50_Str50.jpg" />
  <figcaption>Wavelet_chrom_Link_50_Str50.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_toning_opBYfull.jpg"
  title="wavelet_toning_opBYfull.jpg" />
  <figcaption>wavelet_toning_opBYfull.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_toning_opBYfull_curve.jpg"
  title="Wavelet_toning_opBYfull_curve.jpg" />
  <figcaption>Wavelet_toning_opBYfull_curve.jpg</figcaption>
  </figure>

</div>
<div>

- <figure>
  <img src="/images/Wavelet_toning_opBY.jpg" title="Wavelet_toning_opBY.jpg" />
  <figcaption>Wavelet_toning_opBY.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_toning_opBY_Str50.jpg"
  title="Wavelet_toning_opBY_Str50.jpg" />
  <figcaption>Wavelet_toning_opBY_Str50.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_toning_opBY_curve.jpg"
  title="wavelet_toning_opBY_curve.jpg" />
  <figcaption>wavelet_toning_opBY_curve.jpg</figcaption>
  </figure>

</div>

　最終画像でもまだブルーのハロが若干残っていますが殆ど目立たないので、最初の画像（クロマリンク50、強さ50）とほぼ同じになりました。

## ノイズ除去とリファインのモジュール

　このモジュールはディテールタブにある[ノイズ低減と](Noise_Reduction/jp.md)後述する**エッジのシャープネス**を補完する機能です。

　ノイズの管理は複雑な問題です。その処理工程のモジュールをどこに置くか、（処理工程全体の前の方なのか、それとも後の方なのか）、どの様な処理をどの様に行うか、などを全て絡めて決定しなければならないからです。

　RawTherapeeでは、ディテールタブにある一般的なノイズ低減のモジュールは、全処理工程の前の方にあります。ノイズ低減より処理工程が後に位置する他の機能を使った時に、存在するノイズが先鋭化するのを避けるためです。これを使って、次のような調整が出来ます：

- 　輝度ノイズを一括的に軽減します（ここでもウェーブレット変換が応用されています）。但し、“ウェーブレットのレベル”の様にレベルごとに異なる処理は出来ません。
- 　色ノイズの軽減には異なる方法が使われます。ウェーブレットのレベルで、ディテールの大きいレベル（4～7）で使用されている方法で複雑な処理です。
- 　輝度ノイズの処理の精度を高めるためにフーリエ変換が追加的に使われます。
- 　メディアンフィルタが使えます。

　本来、ノイズ低減はこの機能だけで十分かもしれませんが、ウェーブレットのレベルのノイズ除去との併用で追加的な利点が生まれます（同じアルゴリズムを使っていますが）：

- 　ウェーブレットのレベルのノイズ除去のモジュールは、全処理行程の後ろの方にあるので、他の一般機能（露光補正、トーンカーブ調整、ダイナミックレンジ圧縮など）の使用で生じたノイズを軽減することが出来ます。
- 　最初の4つのレベルのノイズを別々に独立して軽減することが出来ます。一般のノイズ低減機能の方は画像全体で処理するだけです。
- 　ウェーブレットのレベルの他の機能の使用によるノイズ発生を抑えます。例えば、ノイズが目立たないように青空の調整が行えます。
- 　各レベルにおいて、ノイズ低減とコントラスト調整が同時に行えます。これは天体写真の処理の際に便利です。

### コントロール

　以下に説明する調整機能を使って必要に応じてノイズ低減をコントロールします。このモジュールの機能はどのノイズを処理する、というだけでなく、その効果を“エッジのシャープネス”や色ノイズの除去にリンクさせられます。

#### エッジのシャープネスの強さとリンク

　これは各レベルを調整する4つのダブルスライダーの下辺の作用（後述）を変えるオプションです。

- 　このオプションが**無効**の時は、各スライダーの下辺（**強さ**のスライダー）の作用は、全輝度範囲を使ったコントラストのモジュールと似ています。
- 　このオプションが**有効**（✔を入れる）の時は、シャープネスの改善の程を下辺のスライダーで変えることが出来ます（後述のエッジのシャープネスで更に詳しく説明します）。

#### 輝度ノイズ除去のイコライザ

　人間の視覚は、暗い部分にあるノイズより、明るい部分にあるノイズの方が見分けやすいという性質を持っています。たとえ暗い（シャドウ）部分のノイズの方が多くても、その性質は変わりません。

　このスライダーを使うと、シャドウ部分のノイズ低減をより強くしたり（右に移動）、ハイライト部分のそれをより強くしたり（左に移動）することが出来ます。

　調整の際には、シャドウ部分とハイライト部分のノイズの状態を比較できるので、明るい部分と暗い部分の両方が存在する領域を選ぶといいでしょう。

#### ノイズ低減とリファイン

　これら4つのダブルスライダーで、ディテールの小さい番手の低いレベル1～4の輝度ノイズをコントロールします。

- 　スライダーの上辺が**ノイズ低減**をコントロールします。
- 　スライダーの下辺、**強さ**（リファイン）と呼ぶ、は各レベルのディテールのコントラストを調整します。但し、コントラストのモジュールの様な微調整は出来ません。

　強さのスライダー（下辺）は、コントラストのモジュールのスライダーと重複しているように思えますが、ノイズ低減を強く使った場合に失われることのあるディテールのコントラストを回復させるのに便利な機能です。また、“エッジのシャープネス”による4つのレベルへの効果を調整することにも使えます。

#### 色ノイズの低減

　これはディテールタブにある色ノイズの低減機能を補完する機能です。

　前述したように、“ウェーブレットのレベル”は全処理工程の後ろの方に位置しています。そのため、ディテールタブのノイズ低減機能で処理しきれなかった色ノイズや、他の機能の使用で新たに発生した色ノイズを軽減することが出来ます。

　3つのスライダーがあります：

- 　**色ノイズ低減のイコライザ　ブルー/イエロー　レッド/グリーン：**普通、色ノイズはレッド/グリーン、或いはブルー/イエローのドットで現れます。レッド/グリーンのドットの方が多い場合はスライダーを右に、ブルー/イエローのドットの方が多い場合は左に動かして、低減機能を調整します。
- 　**番手の低いレベルの色ノイズ：**小さいディテールのレベルの色ノイズを減らします。
- 　**番手の高いレベルの色ノイズ：**大きいディテールのレベルの色ノイズを減らします。このレベルの色ノイズは、汚れや画像の一部とは異なるような、大きな斑点で現れるので、番手の低いレベルのスライダーでは軽減できない時に使います。

### ノイズ低減の使用例

　どのレベルのノイズが改善しているのか見極めるために、“[プレビューに適用する背景とプロセス](Wavelet_Levels/jp#プレビュー.md)”の説明を参考に、レベルごとに調整を進めることを奨めます。“エッジのシャープネスの強さとリンク”のオプションは無効にします。目的のレベルの“強さのスライダー”を最大値にまで上げます：この操作でノイズが明らかになるので、どの程度のノイズ低減が必要か見極められます。ノイズ低減のスライダー（上辺）の調整を終えた後、強さのスライダーを目標の仕上がりになるまで下げます（マイナス値にすることも可能です）。それから、次のレベルの調整に入ります。

<div>

- <figure>
  <img src="/images/Wavelet_denoise_orig.jpg" title="Wavelet_denoise_orig.jpg" />
  <figcaption>Wavelet_denoise_orig.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L2d00s100.jpg"
  title="Wavelet_denoise_L2d00s100.jpg" />
  <figcaption>Wavelet_denoise_L2d00s100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L2d30s100.jpg"
  title="Wavelet_denoise_L2d30s100.jpg" />
  <figcaption>Wavelet_denoise_L2d30s100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L2d30s27.jpg"
  title="Wavelet_denoise_L2d30s27.jpg" />
  <figcaption>Wavelet_denoise_L2d30s27.jpg</figcaption>
  </figure>

</div>
<div>

- <figure>
  <img src="/images/wavelet_denoise_L1d00s00.jpg"
  title="wavelet_denoise_L1d00s00.jpg" />
  <figcaption>wavelet_denoise_L1d00s00.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L1d00s100.jpg"
  title="Wavelet_denoise_L1d00s100.jpg" />
  <figcaption>Wavelet_denoise_L1d00s100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L1d12s100.jpg"
  title="Wavelet_denoise_L1d12s100.jpg" />
  <figcaption>Wavelet_denoise_L1d12s100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_L1d12s-17.jpg"
  title="Wavelet_denoise_L1d12s-17.jpg" />
  <figcaption>Wavelet_denoise_L1d12s-17.jpg</figcaption>
  </figure>

</div>
<div>

- <figure>
  <img src="/images/Wavelet_denoise_orig.jpg" title="Wavelet_denoise_orig.jpg" />
  <figcaption>Wavelet_denoise_orig.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_final.jpg"
  title="Wavelet_denoise_final.jpg" />
  <figcaption>Wavelet_denoise_final.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_orig100.jpg"
  title="Wavelet_denoise_orig100.jpg" />
  <figcaption>Wavelet_denoise_orig100.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_denoise_final100.jpg"
  title="Wavelet_denoise_final100.jpg" />
  <figcaption>Wavelet_denoise_final100.jpg</figcaption>
  </figure>

</div>

　ノイズ低減とシャープネスは常に妥協の産物です。ノイズ低減を強くするほどノイズは減りますが、その分画像のディテールが失われてしまうという、相反関係にあるからです。原則として、画像編集においてノイズを“完全”に除去する処理は好ましくありません。何故なら、同時に大切なディテールも失われ易いからです。むしろ目立たない程度にノイズを軽減し、同時にディテール部分のコントラストを増やす（リファイン）のが最良の結果を生みます。ディテールの存在感を増やすことで、画像を見た時にノイズが目立つことなく、柔らかい質感だけが残ります。手順は以下の通りです：

1.  準備として、ディテールタブのノイズ低減機能を使って画像全体の輝度ノイズを下げます。但し、ディテール部分を失わない程度に控え目に行います。
2.  ウェーブレットの設定で、背景色にグレーを選び、“表示レベル”を選択したレベルだけにして、表示レベルを1にします。
3.  拡大率を300％～400％にして、レベル1の画像の中で詳細が乏しい部分を探します。
4.  レベル1の強さ（下辺）を、ディテールとノイズの区別が出来るように、最大あるいは最大近くまで上げます。
5.  レベル1のノイズ低減（上辺）を、中程度まで上げます（ノイズが完全に除去されないように注意します。それから強さを元の位置（0）に戻します。
6.  以上のノイズ低減処理でディテールのコントラストが失われた場合は、そのコントラストが回復する程度に強さを調整（上げる）します。
7.  表示レベルを2に変えて、繰り返し4～6の手順の調整を行います（2番目のダブルスライダーで）。
8.  レベル3、4についても同じ操作を行います。
9.  設定の表示を“レベル全体”に戻します。

ノイズが少ない画像の場合は手順2から始めても構いませんが、ノイズが多い場合は手順1（特にシャドウ/ハイライト部分を考慮しながら）から始めるのが肝要です。

　ディテールの存在感を高めるには、ダブルスライダーの下辺を大きく右に動かせばコントラストを上げることが出来ますが、それ自体が目的ならばコントラストのモジュールのコントラストスライダーを使うことを奨めます。そちらの方がよりコントロールが効くだけでなく、アーティファクトの発生が少なくて済みます。上記の例では、ノイズ低減と強さのスライダーだけで処理が行われていますが、更に仕上がりを調整するために必要であれば他のスライダーを使って調整が出来ます。

　このモジュールのノイズ低減と、次のエッジのシャープネスの中の**エッジ検出**に使われる**しきい値　低（ノイズ）**とは異なります。後者はエッジのシャープネスを改善させる際にノイズが増幅されるのを防ぐためのもので、ノイズを減らすわけではありません。

## エッジのシャープネスのモジュール

　このモジュールは、各レベルのディテールにエッジ検出のアルゴリズムを適用してシャープネスを高める機能です。

　一見すると、ウェーブレット変換で生成される残差画像がマスクの様に見えるので[アンシャープマスクに](Sharpening/jp#アンシャープマスク.md)似ていると思われるかもしれませんが、全く異なります。

　この機能を使って、アンシャープマスク、或いは[RL
デコンボリューションの](Sharpening/jp#RL_デコンボリューション.md)様な効果を求める場合は、“エッジ検出”のオプションを有効にして、“グラデーション感度”を高く（70以上、デフォルトでは90が設定されています）する必要があります。また、“詳細レベルによるコントラスト調整”を併用している場合は、レベル1の調整は避けます。レベル1を調整すると、このアルゴリズムの働きが悪くなるからです。

　モジュールの使い方を説明する前に、強いアーティファクトや効果が過剰になるのを避けるため、以下のことを覚えておいて下さい：エッジ検出は[エッジ検出の効力](Wavelets/jp#エッジ検出の効力.md)（D2、D4…D14）と[ノイズ低減とリファインの](Wavelets/jp#ノイズ低減とリファイン.md)各強さのスライダー値（“エッジのシャープネスの強さとリンク”のオプションが有効になっている場合）に大きく影響されます。効果を見極めながら、必要に応じて目標とするシャープネスを得るために機能の再調整を行って下さい。

　インターフェースは3つのグループに分けられます：

- 　**設定：**エッジを検出するための機能を設定します。
- 　**ローカルコントラスト：**初期のコントラスト値を基本に、コントラスト調整をディテールにどの様に適用するか設定します。
- 　**エッジ検出：**目標とする部分のシャープネスを高めます（例、エッジ部分）

### 構成

　**まず、インターフェースの下段にある“形状検出”のオプションを無効にしたまま調整を行います（有効した場合は効果が変わります）。**

　4つのスライダーについて説明します：

1.  　**強さ：**ディテールに対するコントラスト強調の適用量を調整します。設定値を大きくするほど、コントラストの変化が大きくなります。小さなディテールのレベルに対する効果が強まります。スライダーをリセットすると、モジュールの他の調整も効果がキャンセルされます。
2.  　**減衰応答：**コントラストのモジュールの[減衰応答と](Wavelet_Levels/jp#コントラストの減衰と選択.md)同じように働きます。
3.  　**半径：**調整により画像の遠近感が変わるので、ディテールにボリューム感が増える、或いは質感が向上した印象になります。作用が線型的ではないので、スライダー値が0でも効果がないということにはなりません。正規分布に近い関係です。尚、半径の作用は“ディテール”スライダーの影響を受けます。
4.  　**ディテール：**レベル間のコントラストの分布を変えるスライダーです。右に移動するほど、最初の3つのレベルへの作用が強まります。逆に左に移動し、0に近づくと、実質的に3つのレベルに対する効果はなくなります。

　以下に示す例を見れば、各コントラストの変化が半径とディテールの設定値に密接に関係していること、そして半径の効果が、ディテールの設定値に応じて変わることが分かると思います。これを説明するために、“最初のレベル”のドロップダウンリストの中から“変えない”（後述）を選び、このモジュールの前のモジュール、“ノイズ低減とリファイン”の“エッジのシャープネスとのリンクの強さ”オプションは無効にしておきます。

- 　**半径とコントラストの関係：**半径の値を変えるとディテールのコントラストが変わります。概ね、半径の値が40～75の時にコントラストが最も増えます。40以下の場合はレベル1のコントラストが大きく増え、75以上の場合はレベル3以上のコントラストが増えます。但し、レベル4から順にコントラストの増え方が小さくなり、レベル9やエキストラレベルでは殆ど増加しません。
- 　**半径とディテールの関係：**ディテールスライダーの設定値に応じて、半径の値が及ぼす各レベルのディテールのコントラストへの作用が変わります。

　以下に要点をまとめます。分かり易いように図式化しました：

<div>

- <figure>
  <img src="/images/Wavelet_edge_sharpening_D-50.png"
  title="Wavelet_edge_sharpening_D-50.png" />
  <figcaption>Wavelet_edge_sharpening_D-50.png</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_edge_sharpening_unchanged.png"
  title="Wavelet_edge_sharpening_unchanged.png" />
  <figcaption>Wavelet_edge_sharpening_unchanged.png</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_edge_sharpening_D100.png"
  title="Wavelet_edge_sharpening_D100.png" />
  <figcaption>Wavelet_edge_sharpening_D100.png</figcaption>
  </figure>

</div>

ディテールスライダーのすぐ下に、“最初のレベル”というドロップダウンリストがあります：

- 　強める：他のレベルに比べてレベル1に対する作用を増やす
- 　変えない：アルゴリズム通りのコントラスト分布を維持
- 　弱める：他のレベルに比べて、レベル1に対する作用を減らす

　これら3つのオプション選択による効果の違いは、画像の中の小さいディテールの数、それらのコントラスト値、そしてエッジ検出の効果の選択（D2、D4、…D14）次第です。例えば、夜間の街並みの撮影で、街灯の明かりが露出オーバーになっているような場合、“弱める”オプションを選択すれば、最初のレベルのノイズのハイライトコントラストが和らぎます。しかし、通常、レベル1には重要なディテールが殆どないので、オプションの選択をあまり気にする必要はないでしょう。

　加えて、**弱める**オプションを使った場合、レベル1に関して変な、或いは少なくとも特異な動作が発生します。半径0で最大のコントラストは半径19まで漸進的にディテールが完全にぼかされる程度にまで低下しますが、半径20の時に突然最大まで上昇します。そして再び半径100に向かって徐々に低下します。イラストで示すと：

<figure>
<img src="/images/Wavelet_edge_sharpening_reduced.png"
title="Wavelet_edge_sharpening_reduced.png" />
<figcaption>Wavelet_edge_sharpening_reduced.png</figcaption>
</figure>

　この問題への最良の対策は、“最初のレベル”のオプションは、**変えない、**を使うことです。“エッジのシャープネスの強さとリンク”のオプションを使う方が、変化がより漸進的で、コントロールし易いと思います。

### エッジのシャープネスの強さとリンク

　以上の説明全ては、ノイズ低減とリファインのモジュールの先頭にある“エッジのシャープネスの強さとリンク”、というオプションが無効であることを前提にしています。無効であることは、コントラストの変化が半径とディテールの値によって決まることを意味しています。

　しかし、このオプションを有効にしていた場合、コントラストの変化は、ノイズ低減とリファインで調整された最初の4つのレベルに従います。そのため一定のレベルだけのシャープネスを調整することが出来ます。コントラストの変化は10個のスライダーで調整するより著しく強くなります。

　例えば以下の様な使い方が可能です：

- 　レベル1のコントラストだけを変えない。
- 　レベル2のコントラストを最大にする
- 　レベル4のコントラストを減らす（強さをマイナスにする）

### ローカルコントラスト

　各レベルに内在するコントラスト（ローカルコントラストとも呼びます）の平均値と標準偏差を計算し、結果をその後の調整に使います。

　“ディテール”と呼んでいるのは、実際には元画像のピクセルの集まりであることを思い出して下さい。番手が高いレベルほど大きなピクセル単位で解析した集まりになります（例、レベル1は2x2ピクセルですが、レベル5は32x32ピクセル、というように）。各ピクセルは、ディテール内の他のピクセルとは異なる輝度の初期値を持っているので、ピクセル間でコントラストを導き出して解析することが出来ます。

　これら各レベルに内在するコントラスト（ローカルコントラスト）に対する如何なる調整も、コントラストの平均値及び標準偏差から導き出されたパターンを基本に行われ、各レベルのローカルコントラスト値に同じ様に適用されます、例えばコントラストの平均値を中心にした一定の範囲。

　例えば次の様な調整が可能です：

- 　元々コントラスト値が低い部分（一般的にはシャドウ部分）:ローカルコントラストを下げて、ディテールを目立たないようにする。
- 　平均的なコントラスト値：ローカルコントラストを上げて、コントラスト値を増幅する。
- 　コントラスト値が高い部分（一般的に非常に明るい部分）：ハイライトが飽和してしまうのを避けるため、この部分のローカルコントラストを下げる、或いはゼロにする

　これらの調整を、しきい値カーブ、或いは非対称正規分布を使って行います：　

- 　しきい値カーブ：これら4つのコントロールポイントは、左からそれぞれ最低コントラスト値、平均コントラスト値、平均+1標準偏差のコントラスト値、最大コントラスト値を意味します。
- 　カーブ：デフォルトのカーブは非対称正規分布で、以下の様に構成されています:
  - 　横軸の中央は平均コントラストを表します。
  - 　中央から左右に横軸の1/3幅は1標準偏差分のコントラスト領域を表します。

**しきい値カーブ**

　![<File:Wavelet> local contrast
thresholds.jpg](Wavelet_local_contrast_thresholds.jpg "File:Wavelet local contrast thresholds.jpg")　しきい値カーブによる調整を選択した場合は、コントロールポイントを右に動かすとコントラスト値が増え、左に動かすと減ります。グレー～ホワイトの背景色部分はコントラスト値が高いことを意味し、グレー～ブラックの部分はコントラスト値が低いことを意味します。

　前述したように、しきい値カーブのコントロールポイントは左から順に、最低コントラスト値、平均コントラスト値、平均+1標準偏差コントラスト値、最大コントラスト値を表しています。例えば、平均コントラスト値のポイントを右に動かすと、平均値に近いコントラスト値が上がります。他のポイントも同様に、各コントラスト値のグループ（平均、標準偏差、最低、最大）が、コントロールポイントの位置に応じた作用を受けます。

　実際には:

- 　デフォルト設定で調整を行うと、通常、画像はより自然な映りになりますが、ハイライト部分が（特にガラスの反射光など）が過度に誇張されてしまうというデメリットもあります。しかし、調整に非対称正規分布を使った場合に比べ、ディテールがより鮮明で自然な形で強調されます。また、ノイズやざらつき感が過度に増えることもありません。
- 　日中に撮影した中間トーンの画像（例えば、市街地風景）であれば、デフォルト設定で、過剰なコントラストを生まずに（但し、窓ガラスの反射光などは過剰になります）、ディテールが強調されます。
- 　しかし、コントラストの高い画像（例えば、都市の夜景や天体写真）の場合、デフォルト設定では電灯や恒星などのコントラストが過剰になります。
- 　ノイズが多く、コントラストの高い画像の場合、“最初のレベル”で“弱める”を選択すれば、レベル1のノイズを減らし滑らかにすることが出来ます。但し、画像のコントラストがそれ程高くない場合は、目に見える効果はないでしょう。

**非対称正規分布**

<div class="parrpad">

<figure>
<img src="/images/wavelet_local_contrast_gauss.jpg"
title="wavelet_local_contrast_gauss.jpg" />
<figcaption>wavelet_local_contrast_gauss.jpg</figcaption>
</figure>

</div>

　こちらの方法を選択した場合は、カーブの形状がディテールのコントラストを調整する際の、視覚的なガイドになりますが、デフォルトで表示されるカーブが最適な形状という訳ではありません。

　しきい値カーブに比べて、影響を受けるローカルコントラストの範囲の調整出来るだけでなく、調整の強さもコントロール出来ます：カーブ上のポイントを左右に移動すれば、影響を受けるコントラストの範囲をしきい値カーブの様に変えることが出来る上に、上下に移動することで、その強さも変えることが出来ます。

　デフォルト設定（![<File:ResetButton.png>](ResetButton.png "File:ResetButton.png")ボタンでリセット出来ます）のローカルコントラストの効果はHiRaLoAm（High
Radius, Low
Amount:アンシャープマスクで半径を大きくする一方で適用量を低くすることで得られる効果）に似ています：シャドウ領域を抑制することで、コントラスト値を高めますが、強いコントラスト部分は目立たないようにします。シャドウ部分のノイズとハイライト部分の露出過多（特に、反射光）を抑制ながら、ディテールのボリューム感を強調するような調整です。但し、中間コントラストのノイズやざらつき感が過度になります。

　しきい値カーブと非正規分布のカーブの選択に優劣はありません。目標とする効果に応じて選びます。但し、非正規分布のカーブを使用する場合は、効果が過度にならないよう、“エッジのシャープネス”の強さは控えめに調節する方がいいでしょう。一方、しきい値スライダーの方は、自然な効果を得るために強さを積極的に上げることが出来ます。非正規分布のカーブを使う利点は、しきい値スライダーと同じ効果の調整が出来るのと同時に、コントラスト値を上下させる、或いはカーブを中央の水平ラインより下げて、フラットなイメージにすることが出来ることです。

<div>

- <figure>
  <img src="/images/Wavelet_local_contrast_curves.jpg"
  title="Wavelet_local_contrast_curves.jpg" />
  <figcaption>Wavelet_local_contrast_curves.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_local_contrast_curves_t.jpg"
  title="Wavelet_local_contrast_curves_t.jpg" />
  <figcaption>Wavelet_local_contrast_curves_t.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_local_contrast_curves_g.jpg"
  title="Wavelet_local_contrast_curves_g.jpg" />
  <figcaption>Wavelet_local_contrast_curves_g.jpg</figcaption>
  </figure>

</div>

### エッジ検出

　このオプションを使う前に、それまでの調整、特にローカルコントラストの調整を注意して行います。このオプション機能を使った調整は、行き過ぎた効果やアーティファクトの発生を避けるため、控え目に行う方がいいでしょう。

　エッジ検出は、各レベルに対し一連の作用を施して、ノイズを先鋭化せずにエッジを際立たせるためアルゴリズムなので、一般的なシャープネスのツール（アンシャープマスク、RLデコンボリューションなど）の効果とは異なります。分解処理されたディテールを強調し、ノイズを除去するためにぼかしをかけて、エッジの一部と見なせる部分を抽出します。

　この機能は分解された構成要素に合うようにカスタマイズしたSobel-Cannyのアルゴリズムを基本にしています。必要な変数を減らし、3つのスライダーにまとめています:

- **グラデーション感度：**スライダーを右に動かすほど、アルゴリズムは明確なエッジに対して作用し、ノイズや小さいディテールのローカルコントラストはあまり考慮しません。逆にスライダーを左に動かすと、エッジ検出の感度が上がり、小さな部分も考慮するようになりますが、その分ノイズが目立つようになります。
- **ローパスフィルタ（ノイズ）：**このスライダーは\[<https://ja.wikipedia.org/wiki/%E3%82%AC%E3%82%A6%E3%82%B7%E3%82%A2%E3%83%B3%E3%81%BC%E3%81%8B%E3%81%97ガウスフィルタ>　ガウスフィルタ\]の構成を変えるスライダーです。画像を直接的に調整するのではなく、分解の係数に作用します。スライダーを右に動かすにつれ、フィルタが3x3マトリクス、シグマ0.55～5x5マトリクス、シグマ1.4まで変化します。画像をぼかすと、ノイズや低コントラストのディテールは失われる、或いは不鮮明になります。このことはノイズの抑制としてはメリットですが、エッジ検出の精度が下がるというデメリットもあります。逆に3x3マトリクスを使えばエッジ検出の精度は上がりますが、その分ノイズが目立ってきます。明らかにエッジと判断される部分を強調したいのであれば5x5のマトリクスを使う方がいいでしょう。

　更に、次のスライダーは、検出したエッジが本当にエッジであるかどうかの判断をして、エッジでない部分を除く働きをします。スライダー値を下げると、コントラストが低いエッジも検出されるようになりますが、その分ノイズをエッジとして認識する可能性も増えます。

- **ハイパスフィルタ（エッジ検出）：**このスライダーはどのディテールがエッジの一部であるかどうかの解析をします。目標となるディテールの輝度を増幅してエッジかどうかの解析を行います。右に動かすほどエッジと認める解析が厳しくなります。左に動かすと解析が甘くなりますが、その分ノイズもエッジとして認識される率も高くなります。

### アルゴリズムの強化

　このオプションを有効にすると、エッジ検出アルゴリズム中の特定の設定を変えることが出来ます：

- **エッジ感度：**このスライダーで設定された値より低いコントラスト値のディテールは破棄されます。スライダーを右に動かすほど、より高いコントラスト値のディテールだけがエッジと見なされます（低いコントラスト値のディテールは無視されます）。
- **基底値の増幅：**エッジ検出の感度を上げる計算をする前に、コントラストの初期値を増幅します。右に動かすほど、エッジとエッジではない部分の区別が向上しますが、アーティファクトの発生リスクも高まります。
- **隣接ピクセル：**目標とするディテール周辺のピクセルがエッジ検出に与える影響を考慮します。考慮しない、少し考慮する、多分に考慮する、という3つから選択します。

### 実例（ノイズ低減の調節とエッジのシャープネス）

<div>

- <figure>
  <img src="/images/Wavelet_pic.jpg" title="Wavelet_pic.jpg" />
  <figcaption>Wavelet_pic.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelet_edge_sharpness.jpg"
  title="Wavelet_edge_sharpness.jpg" />
  <figcaption>Wavelet_edge_sharpness.jpg</figcaption>
  </figure>

</div>

## レベルのぼかしのモジュール

　このモジュールは、特定のレベルにぼかしをかける機能です。番手の高いレベル（7以上）の方の効果が強くなります。特に、天体写真の編集に便利です。

　コントラストのモジュール同様、[減衰応答のスライダーが](Wavelets/jp#コントラストの減衰と選択.md)備わっています。

　**各レベルの輝度に別々にぼかし**を施すことが出来ます。カーブは10個のゾーンに分けられていて、左端がレベル1、右端がエキストラレベルを表しています。カーブを上に動かすと、選択したポイントに近いレベルのぼかしが強くなります。

　**色のぼかし**は、選択したポイント近くのレベルの色をブレンドする機能です。少し汚した様な印象を作ります。

## シャープマスクと明瞭のモジュール

　“シャープマスク”は、既に備わっているエッジを強調する機能（“アンシャープマスク”、“RLデコンボリューション”、ウェーブレット機能の中の“エッジのシャープネス”）に追加した新しい機能で、使用に関しては、単独で使うことも、既存の3つの機能と併用することも出来ます。

　“アンシャープマスク”は、エッジの強調や画像のシャープネス感を高めるために使われる一般的な機能です：各ピクセルの周辺ピクセルに繰り返しぼかしをかけて、ガウスぼかしタイプのマスクを作ります。そして、そのマスクを元画像から差し引いてエッジを強調します。通常、この処理で使われるピクセル半径は小さいものです（1ピクセル～数ピクセル）。このモジュールのマスクはウェーブレット分解の一部に基づいていて、2通りの使い方が出来ます：

- 　**シャープマスク：**小さいディテールのレベルを強調するオプションです。
- 　**明瞭：**大きいディテールのレベルを強調するオプションで、画像のローカルコントラストや色度が強調される印象になります。

　シャープマスク、明瞭、の選択に応じて、以下に示した特定の設定が**自動的**行われます（左パネルの履歴も自動で更新されます）：

|               | シャープマスク           | 明瞭                     |
|---------------|--------------------------|--------------------------|
| 背景:         | 残差画像                 | 残差画像                 |
| 作用レベル:   | 小さいディテールのレベル | 大きいディテールのレベル |
| レベルの番手: | 3以下                    | 7以上                    |

　どちらのオプションも、自動的に設定されたレベルの番手を手動で変更することが出来ます。シャープマスクで番手を変えることは、アンシャープマスクで半径を変えるのと似ています。1～4の間で選択します。明瞭の方は画像の質感（3次元的な印象）に影響します。5～エキストラの間で選択します。

　シャープマスクの場合、融合は選択したレベル以下のディテールの強調と、その結果を他のレベルと融合（ブレンド）する設定になっています。例えば、レベルを3に設定すれば、レベル1、2、3のディテールが強調された後、その結果がレベル4とそれ以上の番手のレベルと融合されます（残差画像も含まれます）。強調されたディテールと、他のレベルとの混成率は、融合スライダーで調整します。

　同様に、明瞭の場合は大きいディテールのレベルが強調され、画像の他のレベルと融合されます。

どちらのオプションでも3つのスライダーを使って調整します：

1.  　**輝度の融合：**右に動かすとディテールのコントラストが強調されます。左に動かすと（マイナス値）ぼかしがかかったような幻想的な印象になります。
2.  　**色調の融合：**右に動かすと色度の高い色調（純色）が、低い色調（明清色）に比べて強調されます。マイナス値を設定すると、鮮やかさが減ります。明清色の色調は殆ど変化しません。
3.  　**ソフトな半径：**融合スライダーの値を高くすると、コントラストの高い部分でハロが発生することがあります。スライダーを使って、画像の印象をあまり変えることなく、ハロの部分を滑らかに修正することが出来ます。しかし、値を大きくするほど、暗い部分が益々暗くなり、強調の調整に必要なコントラストが失われてしまう領域が増えます。

<div>

- ![](wavelet_smc_original.jpg "wavelet_smc_original.jpg")\]

- <figure>
  <img src="/images/wavelet_sharpm_ML60MC30.jpg"
  title="wavelet_sharpm_ML60MC30.jpg" />
  <figcaption>wavelet_sharpm_ML60MC30.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelet_clarity_ML60MC30.jpg"
  title="wavelet_clarity_ML60MC30.jpg" />
  <figcaption>wavelet_clarity_ML60MC30.jpg</figcaption>
  </figure>

</div>

　“ソフトな半径”のスライダーの下に、“ウェーブレットのマスクを表示”というオプションがあります。有効にすると、どのディテールが強調されるか見極めるための助けになります：

- 　シャープマスクの場合は、グレーの背景にディテール部分が白で表示されます（アンシャープマスクの効果を番手の低いレベルだけで見たようになります）。
- 　しかし、明瞭の場合は、ガイド付きフィルタをベースにした異なるマスクが適用され、少し分かり難いかも知れません。ぼかされたような画像ですが、一般的に、白い部分が強調される部分と理解して下さい。

## 残差画像のモジュール

　冒頭で説明した残差画像についておさらいをしておきます。残差画像は、元画像のデータから各レベルのデータの合計を引いたものです。従って、各レベルで行う調整は残差画像に影響しません。逆に残差画像に対して行う調整も各レベルには影響しません。しかし、レベルの総数を増やすほど、元画像から引かれるデータが増えるので、元画像と残差画像の映りの違いが顕著になります。更に、レベルの総数を6以上に設定すれば、残差画像にノイズが残っていることは殆どありません。従って、その残差画像のコントラストや色度を調整してもノイズが先鋭化することはありません。

<div>

- ![](Wavelets_residual_original.jpg "Wavelets_residual_original.jpg")\]

- <figure>
  <img src="/images/Wavelets_residual_L5.jpg" title="Wavelets_residual_L5.jpg" />
  <figcaption>Wavelets_residual_L5.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_L7.jpg" title="Wavelets_residual_L7.jpg" />
  <figcaption>Wavelets_residual_L7.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_L8.jpg" title="Wavelets_residual_L8.jpg" />
  <figcaption>Wavelets_residual_L8.jpg</figcaption>
  </figure>

</div>

　元画像に色空間の限界に近い色調部分が既にある場合、レベルの調整でコントラストや色度を大きく増やすと、殆どのケースでアーティファクトが発生したり、色が色域から外れたりします。この様な状況では、残差画像のコントラストや色度を加減することで、色空間から外れてしまうのを避けることが出来ます。

　この残差画像の特性はウェーブレット変換による処理の重要な側面で、以下の様な調整を可能にしています：

- 　各レベルが内包するディテールに関係なく、シャドウやハイライトを調整する。
- 　マイクロコントラストをより感じ取るために、画像の全体的なコントラストや色度を下げる。
- 　各レベルの過剰な調整で発生したアーティファクトを減らすために残差画像の色度を下げる。

### シャドウ/ハイライト

　シャドウ/ハイライトのスライダーを右に動かすことで、その領域の輝度が増えます。左に動かと（マイナス値）減ります。シャドウ部分を更に暗くしたり、ハイライト部分を更に明るくしたりすることが出来ます：

<div>

- <figure>
  <img src="/images/Wavelets_residual_original.jpg"
  title="Wavelets_residual_original.jpg" />
  <figcaption>Wavelets_residual_original.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_SH.jpg" title="Wavelets_residual_SH.jpg" />
  <figcaption>Wavelets_residual_SH.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_SH-out.jpg"
  title="Wavelets_residual_SH-out.jpg" />
  <figcaption>Wavelets_residual_SH-out.jpg</figcaption>
  </figure>

</div>

　シャドウ/ハイライトの調整効果は、しきい値スライダーの設定値に影響を受けます。しきい値は0～100の輝度範囲です。シャドウのしきい値スライダーを左に動かすと、暗い部分の輝度値に対し、効果が漸進的に制限されます。同様に、ハイライトのしきい値スライダーを右に動かすと、明るい部分の輝度値に対し、効果が漸進的に制限されます。どちらのしきい値スライダーを選択するか迷うような場合は、マウスのカーソルを調整目標上で動かし、ナビゲーターパネルに表示されるL\*値を参考にするといいでしょう。表示される輝度値（L\*）はしきい値スライダーの輝度値と同じ尺度を使っています。

　シャドウとハイライトのスライダーは値がプラスの場合は、シャドウを回復（明るくする）するか、ハイライトを回復（暗くする）するしか出来ません。効果は露光タブの中にある[シャドウ/ハイライトのそれと](Exposure/jp#シャドウ/ハイライト.md)似ています。但し、露光タブのそれとは異なり、[ハイライト復元の](Exposure/jp#ハイライト復元.md)機能は付いていません。

　以下、オプションの有効・無効別に、このモジュールの特性をまとめました：

- 　マイナス値を設定すると残差画像が大きく変化します
- 　ハイライトのスライダーでマイナス値を設定すると暗くなります
- 　ハイライトのスライダーでプラス値を設定すると明るくなります
- 　シャドウのスライダーでマイナス値を設定すると暗くなります
- 　シャドウのスライダーでプラス値を設定すると明るくなります

<div>

- <figure>
  <img src="/images/Wavelets_residual_SHneg_original.jpg"
  title="Wavelets_residual_SHneg_original.jpg" />
  <figcaption>Wavelets_residual_SHneg_original.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_SHneg_old.jpg"
  title="Wavelets_residual_SHneg_old.jpg" />
  <figcaption>Wavelets_residual_SHneg_old.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_SHneg_new.jpg"
  title="Wavelets_residual_SHneg_new.jpg" />
  <figcaption>Wavelets_residual_SHneg_new.jpg</figcaption>
  </figure>

</div>

　オプションが無効になっている場合、“半径”のスライダーが表示されます（有効の場合は表示されません）。

　このスライダーは、それまでの調整に起因するシャドウとハイライトの境界を滑らかにするため、ガイド付きフィルタを適用する機能です。シャドウ、ハイライトで行われた調整の作用範囲をコントロールして、残りの画像と融合する際の状態を改善します。

　シャドウとハイライトの調整は次のような効果が期待できます：

- 　輝く対象にインパクトを与える
- 　ハイライトが飽和してしまうことを避ける
- 　シャドウを明るくする、など

### コントラストの圧縮

　これもウェーブレットのレベルの特筆すべき側面です。コントラストのスライダーで、ディテールのレベルのコントラストに影響を与えずに、残差画像のコントラストだけを調整します。

　残差画像のコントラスを適度に減らすだけで、ディテールのレベルのコントラストが際立ち、深みのあるレリーフ的な印象になります。これにより、アーティファクトが発生し易いディテール部分のコントラストを抑制しながら、見た目にはコントラストが増した時と同じ効果をもたらすことが出来ます。

　しかし、画像によっては残差画像のコントラストを大きくかえることで、趣のある効果を得ることも出来るでしょう。

<div>

- <figure>
  <img src="/images/Wavelets_residual_contrast-.jpg"
  title="Wavelets_residual_contrast-.jpg" />
  <figcaption>Wavelets_residual_contrast-.jpg</figcaption>
  </figure>

- <figure>
  <img src="/images/Wavelets_residual_contrast%2B.jpg"
  title="Wavelets_residual_contrast%2B.jpg" />
  <figcaption>Wavelets_residual_contrast%2B.jpg</figcaption>
  </figure>

</div>

　このモジュールの効果をコントロールするための補助として、残差画像のダイナミックレンジを調整するための方式がオプションとして2つ設けてあります。コントラスト方式とトーンマッピング方式です。

#### 圧縮の方式：コントラスト方式

　調整ポイントの移動と効果はほぼ線形的な関係です。右に動かせばコントラストが増え、左に動かすと減ります。但し、スライダーの調整効果はアーティファクトが発生しないよう機能の内部で制限が働くように設計されています。

　**ダイナミックレンジの圧縮**は残差画像のダイナミックレンジを変えます：右に動かせばダイナミックレンジが狭まり（シャドウが明るく、ハイライトが暗くなります）、左に動かすとダイナミックレンジが広がります（シャドウが更に暗く、ハイライトが若干強まります）。

　**ガンマの圧縮**はハイライトとシャドウの分布を変える働きをします：実質的には、ヒストグラムを左右に動かすのと同じです。

　これらオプションを使って、例えば霞の影響を減らしたり、ハイダイナミックレンジの画像のダイナミックレンジを狭めたり出来ます。

#### 圧縮の方式：トーンマッピング方式

　この方式はメインの[トーンマッピングと](Tone_Mapping/jp.md)同じ機能を使ってコントラストを圧縮します。各スライダーの働きも同じです。作用が及ぶのは残差画像だけですが、メインのトーンマッピングと同じように、コントラストに詳細な変化を与えます。そのため、画像全体のバランスを保つために各レベルの再調整が必要になるケースが多いでしょう。

　このオプションはトーンマッピングを残差画像に適用することですが、メインのトーンマッピングと併用することも出来ます。但し、併用によりアーティファクトの発生があるかもしれないので注意が必要です。

### ぼかし

　2つのスライダーで構成されるこの機能は些末な機能に感じるかもしれませんが、残差画像の輝度と色の構成要素にぼかし（それぞれ、**輝度のぼかし、色度のぼかし**）をかけることで\[<https://ja.wikipedia.org/wiki/%E3%83%9C%E3%82%B1_(%E5%86%99%E7%9C%9F)>　ボケ\]味を改善するのに役立ちます。

　効果の程は、スライダーの設定値、及びウェーブレットのレベルの総数に関りがあります：よいボケ味を得るためには、背景を適度にぼかす、或いは完全にぼかす、に応じて画像のディテールの量を調整することが必要です。

　普通は、レベル7以上に適度なぼかし（50）をかけることが良い結果になるでしょう。小さいディテールのレベルに適用したり、極端に高い値を適用したりすると、ハロやアーティファクトが発生する可能性があります。

### 残差画像の色度

　色度のスライダーも先に説明したコントラストのスライダーと同じ原理で作用します。残差画像の色度が変化します。

　色度の“強さ”（スライダー）は以下で説明する青空の色相保護範囲の設定値と連動しています。

#### 青空の色相

　機能名には“青空”が付いていますが、どの様な色相範囲でも設定可能です。ここで設定された色相範囲に上記の強さのスライダーが適用されます。

　デフォルトで色相範囲が青空に設定されているだけです。

#### 青空の目標/保護

　上記の色相のしきい値カーブを使って定義した色相に対する調整の意図を選ぶスライダーです：

- 　0の場合は、強さの調整が画像の全ての色相に均等に適用されます。
- 　-100の場合は、設定された色相範囲を中心に色度の強さが変わります。
- 　+100の場合は、設定された色相範囲以外の色相の色度が変わります。

　人肌の色度が過度になるのを避けたい場合に便利な機能です。人肌の色相範囲を設定し、‐100にして人肌の色相に影響を与えないようにします。単に強さを高めると人肌が過度に赤味を帯びてしまうことになるでしょう。

### 残差画像のカーブ（色相）

　色分けされた縦線とグリーンの節点からなるこのフラットカーブの調節は、前述の色度のスライダーや“青空の色相”範囲の作用から独立しています。従って、このモジュールの他の調節とは無関係に、主体色の色調を調整することが出来ます。

　このフラットカーブは次の様に働きます：グリーンの節点を中央より上に上げると、その節点に相当する色相が右側の色相に変化して行きます。下げると左側の色相に近づきます。例えば、イエローの色相の節点を持ち上げると、残差画像のイエロー部分にグリーンが加わって来ます（イエローの縦線の右側がグリーンなので）逆に下げると、レッドが増えてオレンジ色に近づきます（イエローの縦線の左側がレッドなので）。

### 色調とカラーバランス

　このオプションを有効にすると、“ハイライト”、“中間トーン“、”シャドウ“という3組のスライダーが表示されます。これらで残差画像の色調を調整出来ます。

　L\*a\*b\*色空間の補色次元a\*とb\*に作用して色調を変えます：

- 　補色次元a\*：グリーンからマゼンタに至る次元
- 　補色次元b\*：ブルーからイエローに至る次元

　スライダーを動かす大きさ次第で結果が変わります：

- 　大きく動かすと極端な結果になります。[色度のモジュールによる](Wavelet_Levels/jp#色度のモジュール.md)調整も似たような結果を生みますが、こちらは残差画像だけに作用します。併用することに問題はありません。
- 　適度な調整はホワイトバランスを手動で行うような効果になります：例えば、主要なディテールがシャドウ部分にあり、且つブルーの色被りがある、背景は完全な昼光でホワイトバランスが異なる、といった画像の場合、シャドウのスライダーを使ってブルーの色被りを除き、背景を再調整し、各輝度範囲でホワイトバランスをカスタマイズすることが出来ます。

　注意：前述の各領域の輝度を変える残差画像のコントラスト圧縮は、上記の機能で調整した結果に直接的に影響します。

## 最終調整のモジュール

　このモジュールは画像に対して微細な調整が行えます。但し、モジュールがウェーブレットのレベルの処理工程の最後に置かれているので、あまり大きな調整を行うと、それまでに他の機能を使って行った調整の効果が変わってしまい、再調整する必要が出てくるかもしれません。

### 方向のバランスによるコントラスト調整

　初期の3方向（垂直、水平、斜め）からの画像分解のバランスは、全般的に調整を通じて保たれていますが、この機能でそのバランスを変えることが出来るので、異なる効果が得られます。

#### 調整方法

　このバランスコントロールは、斜め方向からの分解と垂直・水平方向からの分解のバランスを変える機能です。原理は\[<https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%AC%E3%82%B9%E3%82%AD%E3%83%BC%E5%88%86%E8%A7%A3>　コレスキー分解\]をベースにした\[<https://www.cs.huji.ac.il/~danix/epd/>　輪郭保持型分解\]に似ていて、画像の輝度を線形的に変えます。

　このモジュールは次の機能の調整効果を変えることが出来ます：コントラスト、色度、残差画像のトーンマッピング。

　2つの方法から選びます：

- 　スライダー：ドロップダウンリストの中からこれを選択すると、**斜め/垂直・水平のバランス**、というスライダーが表示されます。これを使って画像のコントラストを変えることが出来ます。右に動かすと全体的なコントラストが上がります。左に動かすと下がります。画像分解の方向のバランスを変えることでコントラストを変えるので、スライダーを極端に動かすと醜いアーティファクトが発生するでしょう。
- 　カーブ：**斜め/垂直・水平のバランス**を調整するカーブ（▽ボタンを押してイコライザを選択します）が表示されます。画像の輝度値のバランスに作用します。

　どちらの方法にも**レベルのデルタバランス**という、もう一つ別の調整機能があります。設定値が0（デフォルト）の場合は、全てのレベルが均等に処理されます。スライダーを左に動かすほど、番手の低いレベルが強調され、高いレベルに対する処理が弱まります。右へ動かした場合はその逆です。

　必要に応じて[減衰応答を](Wavelets/jp#コントラストの減衰と選択.md)使うことが出来ます。

　最後に**色度のバランス**というオプションがあります。有効にすると、先のスライダー或いはカーブを使って色の要素の斜め/垂直・水平バランスを変えられます。

### 最終的なローカルコントラスト

　このカーブは処理工程の最後の方に置かれていて、分解した画像の**再合成直前**に各レベルのコントラストに非線形的に作用します。

　注意：これは輝度ではなく初期のローカルコントラストに対して作用するカーブで、前述のコントラスト調整と重複しません。

　横軸はローカルコントラストを表し、中央が平均値で、節点（グリーン）と節点の間がローカルコントラストの1標準偏差に相当します。カーブの形を変えると、コントラスト係数、エッジのシャープネス、バランス調整の方法、ウェーブレット変換の根本である、分解・再合成の効果が増減します。

　デフォルトではカーブがフラット（効果なし）に設定されているので、目的に合わせてカーブの形を変えます。例えば、ローカルコントラストが低い部分を下げることでノイズを目立たなくしたり、高い部分を下げてアーティファクトを軽減したりします。

　ここでも[減衰応答を](Wavelets/jp#コントラストの減衰と選択.md)使うことが出来ます。

### ‘後’のコントラストカーブ

　このカーブは前述のカーブとは関係ありません。ウェーブレットのレベルの処理工程の最後にあり、各レベルと残差画像を**再合成した後**の画像のグローバルコントラストを変えます。

　このカーブはRawTherapeeの他の機能に備わっているトーンカーブと同じように輝度に作用します。但し、他のカーブの様に背景にヒストグラムは表示されません。

　最後に**ソフトな半径**のスライダーがあり、選択した領域にぼかしをかけて、画像の馴染みを改善することが出来ます。

## 最終比較

 

<div>

- <figure>
  <img src="/images/wavelets_original_big.png"
  title="wavelets_original_big.png" />
  <figcaption>wavelets_original_big.png</figcaption>
  </figure>

- <figure>
  <img src="/images/wavelets_final_big.jpg" title="wavelets_final_big.jpg" />
  <figcaption>wavelets_final_big.jpg</figcaption>
  </figure>

</div>
