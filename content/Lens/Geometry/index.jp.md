---
title: Lens Geometry jp
contributors:
  - Yz2house
---

<div class="pagetitle">

レンズ/ジオメトリ

</div>

　変形調整が行われる際、プレビュー画像への反映を速くするために、このセクションの機能が使われると、RawTherapeeは元画像ではなくプレビューの画像を使ってその調整を行います。そのため、プレュー画像の映りが甘くなることがあります。例えば、ニコンD7000で撮った4256x2832pxサイズの画像（つまり、12.1メガピクセル）の編集で、そのプレビュー画像のサイズが600x400pxだとしましょう。回転ツールを使って角度を5°変えることは、フルサイズの画像を5°動かしていることと同じではありません。600x400pxにスケールダウンした画像に対して行っているのです。そのため映りが多少甘くなることがありますが、その分処理時間が短くて済みます。RawTherapeeは操作効率も重視しているので、この様な方法を取ります。しかし、ご心配なく。調整された画像を保存する際は、元のフルサイズ画像で調整を行うので、シャープ感は全く損なわれません。ですから、画像を100％![<File:Magnifier-1to1.png>](Magnifier-1to1.png "File:Magnifier-1to1.png")に拡大すれば、保存される画像の状態を確認出来ます。

## イントロダクション

　この機能は共通の調整パラメータを持つ幾つかのサブツールで構成されています。それらを使って、カメラ機器の不完全性に起因する、レンズの歪みや周辺光量不足を修正したり、カメラの配置や調整に起因する水平線の食い違いや遠近感の歪みを改善したりすることが出来ます。

### レンズフード

　画像の隅にレンズフードなどがぼやけて写ってしまうケラレと周辺光量不足の問題を混同しないように。カメラの中には、特に小型カメラーコンパクトデジタルやブリッジカメラ、更にはミラーレスまで、レンズフードやレンズ機構の一部が画像に写り込んでしまうものがあります。典型的に、その様なカメラには歪みの強い安価なレンズが付いています。この様なカメラが採っているこれら2つの問題の解決方法は、レンズの歪みやレンズフードの写りで暗くなってしまった画像の隅を画像フレームの外側に“押し出して”しまうことです。これらカメラのJPEG画像を見た時は既に歪みの部分が修正されているので、そのカメラの保有者が問題の存在に気付くことは稀です。しかし、そのraw画像を見れば、問題の存在を知り驚くでしょう。

　ケラレで隅が暗くなる問題を周辺光量補正で解決することは出来ません-何故ならこれら隅はレンズフードや、レンズ機構で遮られたので、画像の情報がないからです。この歪みを補正するには、これらのカメラが行うよう、暗い隅を削除するしかありません。

## 自動補正

　これらサブツールの幾つかは、貴方のカメラとレンズが持つ不完全性を説明するデータを利用して、クリック一つで自動的に作動させることが出来ます。そのデータの元になるのが、LensfunとAdobeLCPです。

### Lensfun

　Lensfunはレンズのパラメータのデータベースを提供しているオープンソースのプロジェクトです。詳しい情報が[Lensfun
FAQ](https://lensfun.github.io/faq/)にあります。

　RawTherapeeの“レンズ補正プロファイル”と“遠近感の歪み”機能は、Lensfunのデータベースを使って、正しくカメラとレンズの情報の特定し、最適な補正パラメータを見つけて、補正作業を簡素化し自動で行います。

　RawTherapeeが自動でLensfunのデータベースを検索するためには、撮影に使われたカメラとレンズを知る必要があります。その情報は画像のメタデータから復号しています（現在はそのために独自のソリューションを使っていますが、将来は[Exiv2](https://exiv2.org/)を使う予定です）。カメラ機種とレンズの情報が正しく復号されているか、どうかを確認するには、画像を開いて編集タブのツールバーにある“画像の情報”ボタン[image:info.pngを](image:info.png.md)押します。ボタンの下にカメラ機種とレンズの名前が表示されます。表示されない場合は、RawTherapeeがそれらの情報を正しく復号出来なかったことを意味します。今のところ、この問題には対処出来ていませんが、Exiv2を使う予定にしている、新しいバージョン（6.0）で解決されると思います。

　画像から、貴方のカメラ機種とレンズの情報を自動で復号出来なくても、手動でそれらを特定することが出来るかもしれません。

#### Lensfunのデータベースに問題がないか確認

　RawTherapeeが使うLensfunのデータベースに問題がないか確認します。レンズ補正プロファイル機能で“手動で選択”にチェックを入れ、ドロップダウンリストの中を見ます。中に情報が表示されていなければ、RawTherapeeのインストールで不備が発生した可能性もありますので、再インストールしてみて下さい。それでも問題が解決しない場合は、私たちの[フォーラムを](forum/jp.md)通じて助言を求めることが出来ます。

#### Lensfunのデータベースに貴方のカメラ機種/使用レンズの情報が含まれているか確認

　
　レンズ補正プロファイル機能の“自動で選択”にチェックを入れます。データベースの中に貴方のカメラ機種と使用レンズがあれば、自動でそれらが表示されます。

　プロファイルの“自動で選択”が上手く機能しないことがあります、よくある原因は：

- 　RawTherapeeがカメラ機種とレンズの情報を復号出来ない。
- 　貴方が利用しているバージョンのLensfunのデータベースに、貴方のカメラとレンズのプロファイルの組み合わせが存在しない。
- 　プロファイルは存在するが、名称やパラメータが照合を行うアルゴリズムのそれらと異なる。例えば、“Pentax”と“Ricoh
  Pentax”、或いは“F4.0”と“f/4”というように。

　この場合は、ドロップダウンリストの中から、手動で正しいカメラ機種とレンズを探してみて下さい。

　貴方のカメラ機種とレンズの情報がドロップダウンリストの中にないケースとして、貴方が使っているLensfunのデータベースが古いために情報が含まれていないこともあります。そこで、Lensfunのデータベースを更新してみます。それでも貴方のカメラとレンズの情報が含まれていなければ、オープンソースプロジェクトであるLensfunに、その情報を提供して頂ければみんなの役に立ちます。詳しくは[Lensfun解説](https://lensfun.github.io/calibration/)を参考にして下さい。

#### LinuxでLensfunのデータベースを更新する方法

[`lensfun-update-data`](https://lensfun.github.io/manual/v0.3.2/lensfun-update-data.html)の実行ファイルを作動し、最新のデータベースをダウンロードします。RawTherapeeを再起動します。

　或いは、Lensfunのデータベース（`/usr/share/lensfun/`）から必要な部分をコピーし、新しいファイル`$HOME/.local/share/lensfun/myLensfun`に貼り付け、画像に含まれているメタデータと合致するように必要なパラメータを編集します。貴方の画像に含まれているカメラ機種とレンズの名前とパラメータは"画像の情報“[image:info.pngを](image:info.png.md)使って見つけられます。但し、データベースを編集することは可能ですが、アップデート中に貴方の編集が失われる可能性もあるのであまり奨められません。

　Lensfunのデータベースを特別な場所に保存する場合は、[ファイルパスのoptionファイルを](File_Paths/jp.md)編集し、`DBDirectory`のキーバリューをLensfunのカスタムデータベースファイルの絶対パスに設定することで、RawTherapeeにその場所を指示します。

#### WindowsでLensfunのデータベースを更新する方法

1.  　RawTherapeeが開いてれば一旦閉じます。
2.  　Lensfunのデータベースをダウンロードします。適切なXMLファイルを、\[<https://github.com/lensfun/lensfun/tree/master/data/db>　データベース\]から取得する、或いは、\[<https://github.com/lensfun/lensfun/releases>　リリース\]から最新のzipファイルをダウンロードして、`data\db`フォルダの中でXMLファイルを探します。
3.  　これらのXMLファイルをLensfunのデータベースフォルダ`C:\Program Files\rawtherapee\share\lensfun\version_1`に移動します。

### LCP

　Adobe©はLens Correction
Profiles（LCP）とそれを作成するためのツールを提供しています。これらはレンズの歪曲収差、周辺光量不足、色収差（CA）を記述しているテキストファイルで、RawTherapeeの様なLCPを扱えるソフトウェアに読み込ませる(取得に関しては[LCPプロファイルの取得を](How_to_get_LCP_and_DCP_profiles/jp.md)参照)だけでこれらの問題を補正出来るようになります。自動で歪曲収差、周辺光量不足、色収差を補正するために、[Adobe
LCP](https://helpx.adobe.com/camera-raw/digital-negative.html#resources)ファイルを選びます。

　自動で補正を行う[プロファイルされているレンズ補正の](Lens/Geometry#Profiled_Lens_Correction.md)"歪曲収差補正"は、手動で行う[〈歪曲収差補正〉と](Lens/Geometry/jp#Distortion_Correction.md)、また、“周辺光量不足補正”は手動で行う[周辺光量不足補正と](Lens/Geometry/jp#Vignetting_Correction.md)併用が可能です。アーティスティックな表現を作りたい、或いは、自動補正だけでは十分ではない、などの理由で、〈プロファイルされているレンズ補正〉の自動補正に、手動による補正を加えることが出来ます。但し、LCP程度の補正に留めるのであれが、手動による補正機能を無効にしておくことを忘れないように。

注意：プロファイルされているレンズ補正の周辺光量不足の補正は、[フラットフィールド](Flat_Field/jp.md)機能と相互排他的であるため、フラットフィールドを使った場合は、LCPの周辺光量不足の補正は無効になります。

　以下の様な制限があります：

- 　歪曲収差や周辺光量不足、色収差の補正はrawファイルのみでサポートされます。但し、歪曲収差はrawファイル以外でも補正が可能です。
- 　色収差補正は、Exif情報に焦点距離が含まれている場合だけです（例、ニコンの画像ファイルでDNG転換したファイル）。
- 　画像編集の迅速な応答を維持するために、LCPの効果の表示にはプレビュー画像を使います。プレビュー画像の解像度は小さいので（実際に見ている大きさしかありません）、歪曲収差補正を施すとプレビューは少しぼけた印象になりますが、実際に保存される画像はシャープ感が維持されています。プレビューを100％に拡大すればそれが確認出来ます。

　他の機能と同様、特定のLCPを複数の画像に適用することが出来ます。そのLCPプロファイルを処理プロファイルの中に入れる（共通に使うプロファイルを作成、を参照）、或いは同じレンズで撮影した画像を複数選び（ファイルブラウザタブにあるメタデータフィルターを使えば簡単）、ファイルブラウザタブからそのLCPを適用します。

## インターフェイス

### 方式

　“対数”と“線形”に関してはTODOのページで説明されています。

### オートフィル

<figure>
<img src="/images/Lensgeometry_bluehorse_barrel_distortion_correction.jpg"
title="Lensgeometry_bluehorse_barrel_distortion_correction.jpg"
width="900" />
<figcaption>Lensgeometry_bluehorse_barrel_distortion_correction.jpg</figcaption>
</figure>

<img
src="Lensgeometry_bluehorse_barrel_distortion_correction_autofill.jpg"
title="Lensgeometry_bluehorse_barrel_distortion_correction_autofill.jpg"
width="900"
alt="Lensgeometry_bluehorse_barrel_distortion_correction_autofill.jpg" />
　このオプションは、補正画像と画像枠の隙間が黒い空間に見えないよう、補正画像を拡大、或いは縮小する機能です。

　\[<https://ja.wikipedia.org/wiki/%E6%AD%AA%E6%9B%B2>　樽型歪\]のある画像を歪曲収差の調整機能で修正すると、この*オートフィル*は補正画像を枠いっぱいに収まるよう縮小するので、不必要に画像の一部を失うことはありません。また反対に、糸巻型歪の補正時には、補正画像を拡大して枠内に収めますので、補正画像の周りが黒く見えることはありません。

  

#### 自動切抜き

<figure>
<img
src="Lensgeometry_bluehorse_autocrop_after_distortion_correction.jpg"
title="Lensgeometry_bluehorse_autocrop_after_distortion_correction.jpg"
width="900" />
<figcaption>Lensgeometry_bluehorse_autocrop_after_distortion_correction.jpg</figcaption>
</figure>

<img src="/images/Lensgeometry_bluehorse_autocrop_after_rotation.jpg"
title="Lensgeometry_bluehorse_autocrop_after_rotation.jpg" width="900"
alt="Lensgeometry_bluehorse_autocrop_after_rotation.jpg" />
*オートフィル*を無効にすると、[image:Crop-auto.png](image:Crop-auto.png.md)*自動切抜き*が使えます。この機能は画像を改ざんするのではありません、歪みの補正や、回転によって発生した余分な空間を切り取るだけです。

  

### 回転

[900px](image:rotate.jpg.md) 　
　画像の角度を‐45度から+45度の間で変える機能です。“直線選択ボタン![<File:Rotate-straighten.png>](Rotate-straighten.png "File:Rotate-straighten.png")”を使って、画像の垂直度、或いは水平度を補正します。マウスを使ってそのガイドラインを引きます‐マウスをクリックし、ホールドした状態で、新しい垂直、或いは水平の線を引き、放すと、その線に沿った補正が実行されます。

  

### パースペクティブ補正

水平方向  
撮影したい対象が画像の中心から多少ずれていた場合、この水平スライダーで（ある程度）調整が可能です。

<figure>
<img src="/images/perspective_horizontal.jpg" title="perspective_horizontal.jpg"
width="900" />
<figcaption>perspective_horizontal.jpg</figcaption>
</figure>

垂直方向  
建築物の撮影で、垂直線のズレを矯正するのに非常に便利です。どちらのスライダーも値を高くし過ぎると、画像がかなり歪むので注意が必要ですが、気にしなければ、それなりに面白い画像作りが出来るでしょう。

<figure>
<img src="/images/perspective_vertical.jpg" title="perspective_vertical.jpg"
width="900" />
<figcaption>perspective_vertical.jpg</figcaption>
</figure>

  

#### シンプル

- 　水平方向：撮影時に、中心となる部分が少し左右にずれてしまった場合、このスライダーで補正出来ます（但し、限界があります）。
- 　垂直方向：建物などの撮影で建物の垂直ラインが傾いてしまった場合の補正に便利です。

　両スライダーとも値を大きくすると歪みが激しくなるので、意図的にそうした構図にすることが目的でなければ、極端な設定は避けます。

#### カメラベース

　カメラベースのパースペクティブ補正は、物理的に正しい補正を行うために、画角とオプティカルセンターからのオフセットを考慮します。

##### 補正

　以下のパラメータは、画像の特性を明確にして、遠近感の歪みを補正します。

- 　焦点距離：レンズの物理的焦点距離をミリメートル単位でセットするスライダーです。メタデータの中にこれが含まれていれば、自動でセットされます。
- 　クロップファクター：画像のクロップファクター（カメラのクロップファクターとデジタルズームなどの様な追加的クロップ）。メタデータに含まれていればこれらも自動でセットされます。本来、このパースペクティブ補正に必要な情報は画角だけなので、“焦点距離”や“クロップファクター”のスライダーは利便性だけが目的です。画角と同等である焦点距離とクロップファクターの組み合わせを使うことが出来ます。例えば、35ミリメートル換算の焦点距離しか分からない場合は、焦点距離をその数値に合わせ、クロップファクターを1にします。
- 　水平/垂直方向へのシフト：これは画像の中心をオプティカルセンターに合うように移動させる機能です。普通は使う必要のない機能です。ティルトシフトレンズのシフト機能を使って撮影した画像の編集、或いは、既にオフセンタークロップで後処理をした画像の編集を行う様な場合に使います。
- 　回転：光軸を囲むように回転を補正する機能ですが、シフトの後に適用されるため、[回転](Lens/Geometry/jp#Rotate.md)機能とは異なります（水平/垂直方向のシフトが０の場合は、実質的に同じです）。調整値の単位は角度（°）です。
- 　水平/垂直：撮影対象に対するカメラの角度ブレによる遠近の歪みを補正する機能です。単位は角度です。

##### 補正後の調整

　全ての遠近感の歪みを補正した“後”に適用される調整です。

- 　水平/垂直方向のシフト：好みに合わせて画像の中心をセットし直す機能です。単位は画像の縦/横の%です。
- 　回転：全ての遠近感の歪みを補正した後に適用される回転の調整です。

##### 回復

　遠近感の歪みを“加える”機能です。補正後の調整を行わず、水平、或いは垂直方向の補正だけが行われた場合に、水平/垂直方向の補正の強さを和らげるために使います。

　例えば、ビルを撮影した画像をより自然に見えるようにするために使います。水平と垂直方向の補正を行った後、垂直方向の補正の強さを弱くした時に映りが不自然なってしまった場合、垂直方向の回復を使います。

##### 自動

　元々[ART](https://bitbucket.org/agriggio/art/wiki/Home) が
[Darktable](https://www.darktable.org/)から引用した自動補正機能です。画像の中で平行線である可能性が高い部分を探し、自動で遠近感の歪みを補正します。正しく動作させるためには、カメラのデータ（焦点距離、クロップファクター、シフト）が正確にセットされていることが条件です。３つの自動補正オプションがあります：

- 　垂直方向：回転と垂直方向の補正を自動で行います。
- 　水平方向：回転と水平方向の補正を自動で行います。但し、横ブレを意味するカメラの回転はカメラの画素ピッチで決まるため、垂直方向の補正が正しくセットされている必要があります。
- 　両方：回転、垂直、水平方向の補正を自動で行います。

##### 制御ライン

　水平線の自動検知が上手く機能しないことがあります。その場合は、制御ラインを使って手動で補正を行います。制御ラインには水平と垂直の２つがあります。

###### 制御ラインの引き方

　初めに、編集タブの上にあるツールバーのパースペクティブ補正のボタンをクリックするか、制御ラインの編集ボタンをクリックします。

　新たに制御ラインを引く場合は、Ctrlキーを押しながらマウスをクリックします。制御ラインの起点と終点でマウスをクリックします。マウスのボタンを押したままで、制御ラインを目標終点まで引いてから離します。制御ラインの方向に応じて、種類が自動でセットされます。

　制御ラインを微妙に修正したい時は、ラインの終点、或いはラインそのものをクリックしたまま移動します。ラインの種類を変えたい時はラインの中間にあるアイコンをクリックします。

　制御ラインを削除する時はマウスを右クリックします。全てのラインを削除する場合は、キーボードの削除キーを押します。

　制御ラインの編集モードを解除するには、次の何れかの操作を行います：パースペクティブ補正のボタンを再度押す、制御ラインの編集ボタン、または適用ボタンを再度押す、画像を右クリックする、他の画像編集機能に移動する

###### 適用

　編集画面で、制御ラインの“適用”ボタンを押すか、ツールバーのパースペクティブ補正ボタンを押して、制御ラインを使った補正の適用を行います。自動補正のオプションと同じ機能を有する3つのオプションがあります。補正オプションは制御ラインのそれぞれのタイプの数によって決まります。垂直方向の補正に関しては、最低でも2本の垂直ラインと最大で1本の水平ラインが必要です。水平方向の補正も似たような条件があります。少なくとも各タイプのラインが2本必要です。

### プロファイルされたレンズ補正

　これはLensfunまたはAdobeLCPを使って自動補正を行う機能です。

- 　歪曲収差補正
- 　周辺光量不足補正
- 　色収差補正

  

### 歪曲収差補正

![](Rt_distortion_correction.png "Rt_distortion_correction.png") 　
　カメラレンズの歪曲収差を補正します。マイナス値で樽型歪を補正し、プラス値で糸巻型歪を補正します。変形タブの[切り抜きを](Crop/jp.md)有効にして（実行はしない）、“*ガイドタイプ→グリッド*”でグリッド線を表示し、補正の目安として使うことが出来ます。

　“*自動歪曲収差補正*”（Auto Distortion
Correction）ボタンは、貴方のカメラがrawファイルに埋め込んであるJPEG画像に歪曲収差補正を行っている場合だけ使えます（多くのカメラは各rawファイルにJPEG画像を埋め込んでいますが、一部のカメラにはこのJPEG画像に歪曲収差補正を行うものがあります）。この機能は、カメラのJPEG画像を見て、歪曲収差が補正されていれば、raw画像の方もそのJPEG画像を真似て歪曲収差を補正するものですが、2点ほど制限があります：

- 貴方のカメラがJPEG画像に歪曲収差補正していなければ、この自動機能は効果がありません。
- カメラによるJPEG画像の歪曲収差補正が十分でない、或いは過分な場合は、raw画像に対する補正もそれと同じになります。但し、その補正値は*Amount*のところに表示されますので、手動による追加調整が出来ます。

  

### 色収差補正

<figure>
<img src="/images/chromatic_aberration_auto1.jpg"
title="chromatic_aberration_auto1.jpg" width="900" />
<figcaption>chromatic_aberration_auto1.jpg</figcaption>
</figure>

<figure>
<img src="/images/chromatic_aberration_auto2.jpg"
title="chromatic_aberration_auto2.jpg" width="900" />
<figcaption>chromatic_aberration_auto2.jpg</figcaption>
</figure>

　*変形*タブの中にあるこの*色収差補正*は、**デモザイク後**に適用されます。一方、Rawタブの中にある[色収差](Chromatic_Aberration/jp.md)補正は**デモザイク前**に適用されます
。

　“レッド”と“ブルー”のスライダーを使って色収差を補正します。通常、色収差はプレビュー画面の大きさの画像では確認できないので、この機能を使う際は、[image:New-detail-window.pngを](image:New-detail-window.png.md)使って詳細ウィンドウを開くか、プレビュー画像を100％![<File:Magnifier-1to1.png>](Magnifier-1to1.png "File:Magnifier-1to1.png")以上に拡大して確認が必要です。他のソフトでも同じですが、このアルゴリズムはある程度の色収差であれば、かなり補正することが出来ます。しかし、やはり万能ではないので、極度な色収差は補正出来ません。

  

### 周辺光量不足補正

　周辺光量不足とは、画像の四隅で光量が減り、画像中央部分に比べ暗くなる歪みです。安い望遠レンズと、高級レンズの大きな違いの一つが、この周辺光量でしょう。前者は周辺光量不足が生じやすく、後者はそうでもないということです。周辺光量不足補正はそれを[切り抜きに](Crop/jp.md)関わらず補正します。但し、この機能は芸術的な意図で使う機能ではありません。意図的に周辺の光量を変える時は、露光タブにある[ビネットフィルターを](Vignetting_Filter/jp.md)使います。

適用量  
*適用量*でプラス値を設定すれば、画像の四隅が明るくなり、典型的な周辺光量不足を補正出来ます。マイナス値は逆に四隅が暗くなります。

半径  
四隅のどの辺りから、明るくしたり、暗くしたりするかを決めます。低い値にすると暗くなる部分が大きくなり、高い値にすると、暗くなる部分は小さくなります。

強さ  
*適用量*と*半径*の設定を増幅させる機能です。*適用量*を‐100、*半径*を50にして、強さを1～100まで動かして、違いを確認してみて下さい。
