---
title: How to create DCP color profiles jp
contributors:
  - Yz2house
---

<div class="pagetitle">

DCPカラープロファイルの作り方

</div>

## DCPプロファイルとは？何故必要なのか？

　技術的に言うと、デジタルカメラの\[<https://ja.wikipedia.org/wiki/%E5%9B%BA%E4%BD%93%E6%92%AE%E5%83%8F%E7%B4%A0%E5%AD%90>　イメージセンサー\]のフォトサイト（格子のように並んでいる部分）は、そこに当たった\[<https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A9%E3%83%88%E3%83%B3>　フォトン\]に応じて一定の電流を出力します。この電流は数値に変換されます。そして、幾つかのメタデータと共に、これらの数値が、rawファイルに保持されます。この時点では、まだ色の観念が無く、rawデータは画像とは似ても似つかないものです。普通の写真として使えるようにするためには、この画像データを“現像”しなければなりません。その現像処理のステップの1つが、先程の数値を正確な色に解釈する作業で、特定の色と数値を付け合わせるための輪郭図、つまり、そのカメラのプロファイルが必要なのです。

　実践的に言えば、正確に色を表現するためにはカラープロファイルの使用が不可欠で、今のところそのための最も有力なプロファイルが“DNGカメラプロファイル”（略称：DCP、Digital
Cinema
Packageも同じ略称ですが全く別なものです）です。入力カラープロファイルとは、貴方による編集が実行される以前の、カメラが行う色表現のプロファイルです。

　RawTherapeeは以下に示すタイプのプロファイルを提供しています：

1.  ICC-これらは昼光で撮影した画像のために調整されたマトリクスプロファイルで、白熱電球の光で撮影した画像にはあまり適しません。古いタイプのプロファイルです。
2.  DCP-これらは新しいタイプのプロファイルです。
    1.  DCP単元-光源：昼光で撮影した画像だけのために調整されたプロファイルです
    2.  DCP二次元‐光源：昼光及び白熱電球の光で撮影した画像のために調整されたプロファイルなので、殆どの光源の元で撮影された画像に適するプロファイルです。

　色の正確性を極めるために、特定の光環境に合わせたユーザー独自のDCPプロファイルを作ることも可能です。例えば、貴方が結婚式の撮影をするとしましょう。正確で首尾一貫した色が必要ですが、外の光と建物の中の光の\[<https://ja.wikipedia.org/wiki/スペクトラム>　スペクトラム\]は全く異なるものです。更に同じ建物の中でも部屋によって光が違うでしょう。一般家庭で使われる電球と、結婚式会場の部屋の電球はその色温度やスペクトラムが異なりますし、会場の部屋には複数タイプの電球が設置されているでしょう。貴方が、X-Rite
ColorChecker
Passportのような、カラーキャリブレーションチャートを持っていれば、写真を撮る同じ位置から、このチャートの写真を一枚撮ります。光環境ごとにその写真を撮ります（一般的には撮影する部屋ごとに一枚と、外で一枚です）。これらの画像を使ってDCPプロファイルを作成し、それをRawTherapeeの現像に使うことで、正確で首尾一貫した色と\[<https://ja.wikipedia.org/wiki/ホワイトバランス>　ホワイトバランス\]の取れた画像を作ることが出来るのです。

## カラーチャート

　殆どの撮影環境に適した最良のカラーチャート（色見本）は、光沢が無く、十分な基準測定となり得る、持ち運びが簡単で丈夫なものです。この理由から私たちはX-Rite
ColorChecker Passport Photoを奨めます。

　カラーチャートのパッチ数が多い方ほど良い見本だとは思わないで下さい-それは必ずしも正しくはありません、パッチ数が多いほど調整が複雑になり、質の良いDCPプロファイルを作るのも難しくなります。

　サポートしているカラーチャート：

- マットタイプ
  - X-Rite ColorChecker Passport
  - X-Rite ColorChecker 24
  - Datacolor SpyderCHECKR
  - X-Rite ColorChecker SG
  - QP-Card 203
  - QP-Card 202
- 光沢版 (使い勝手が悪いので、奨められない)
  - IT 8.7 Reflective DIN A4 (Wolf Faust Coloraid C1)
  - CMP Digital Target 8
  - HutchColor HCT (Fuji RVP)

　更なる情報に関しては、DcamProfの"Choosing test
target"を参照して下さい:
　https://torger.se/anders/dcamprof.html#test_target

## 更なる情報

- DcamProfのマニュアル： <https://torger.se/anders/dcamprof.html>
- X-Rite ColorChecker
  Passportの製品説明ページ：http://xritephoto.com/ph_product_overview.aspx?id=1257
- 同製品のマニュアル（PDF）：http://www.xrite.com/documents/manuals/en/ColorCheckerPassport_User_Manual_en.pdf
- ICCとDCPカラープロファイルに関するQpcardの記事（英語）：
  <http://www.qpcard.com/dcp_icc_profile>

## カラーチャートを撮影する

![](PENTAX_K10D_daylight_london_summer.jpg "PENTAX_K10D_daylight_london_summer.jpg")
![](Colortarget_glare.png "Colortarget_glare.png")
![](Gluehlampe_01_KMJ.png "Gluehlampe_01_KMJ.png")

　以下の説明は、X-Rite ColorChecker
Passportが使用されることを前提にしていますが、私たちがサポートしているカラーチャートであればどれでも構いません。

1.  X-Rite ColorChecker Passport
2.  X-Rite ColorChecker 24
3.  X-Rite ColorChecker SG
4.  QP-Card 203
5.  QP-Card 202
6.  IT 8.7 Reflective DIN A4 (Coloraid C1)
7.  CMP Digital Target 8
8.  HutchColor HCT (Fuji RVP)

　X-Rite ColorChecker
Passportを使っているならば、24個のパッチ部分を撮影するだけでも十分ですが、全体の撮影を奨めます。

　チャートに当てる光（“光源”）には一定の条件("[標準光源](https://en.wikipedia.org/wiki/Standard_illuminant)")があります。2種類の光の下で撮影します：

1.  標準光源A、或いは略称**StdA**で知られる、透明なタングステン白熱電球の光
2.  標準光源Dで知られる昼光。D50（通称Horizon Light）からD65（通称Noon
    Daylight）の間で撮影するように心掛けます。

　カラーチャートの撮影目的は次の2つのケースが考えられます：：

1.  貴方が写真撮影に使ったカメラの、全般的に正確な2次元光源（StdAとD50或いはD65）DCPプロファイルを作り、誰もが使えるようにそれをRawTherapeeに提供するケース
2.  自分で使用するためだけに、特定の光源のDCPプロファイルを作るケース

　前者の場合、誰もがそのプロファイルを使うので、諸条件を満たすプロファイルを作るために特段の注意が必要でしょう。後者の場合、恐らく貴方だけが特定の機会に使うプロファイルなので、他の人が使うことはないでしょう。

RawTherapeeに提供するためのカラーチャート撮影：  

- 白熱電球の光と昼光の両方で撮影したもの
- 理想的には、すっきりと晴れた日を待ち、太陽が水平線から大きく登っている、南中の頃に撮影を行います。明るい曇りの日の正午近くの撮影でも構いませんが、荒天の時や冬季、夏期であっても早朝や夕方は撮影に適しません。日が昇る時や厚い雲の陰、或いはスモッグの陰からのぞく迷光の色が、スペクトラムの中に入ることは避けます。
- 昼光による撮影では、周りに光を反射するような物がない場所を選びます。自宅のバルコニーなどは良くない場所です‐壁が光を反射するのでスペクトラムにマイナスの影響があります、たとえ貴方の目に見えなくても。公園も良くありません。透明な屋根や日よけ傘の下で撮影するのも良くありません。車のない広い駐車場などが適した場所です。光を反射するような壁、木々がありません。クリアーな直射日光以外はいらないからです。フラッシュ撮影は問題外です。どのフラッシュ光も太陽光とは異なるからです。
- 白熱電球の光の下での撮影には、本当のタングステン白熱電球を使う必要があります、今の様にコンパクトな蛍光灯が主流になる以前は当たり前に使用されていた電球です。蛍光灯の光は使わないように、たとえそれが白熱球と似たようなウォームカラーで発光する種類であっても、タングステン光のスペクトラムとは全く異なるからです。ハロゲンライトも、色付き電球も代用できません。
- チャートに反射した光が直接レンズに入りグレア（ぎらつき）が出ることがないよう、光源に対するカラーチャートと貴方の撮影位置を決めますが、その時の伏角が極端に小さくなることも避けます。電球を使う場合は、光の当たり方が不均一にならないよう、光源とカラーチャートの距離が1メートル以下にならないようにします-2メートル程度がちょうど良い距離です。
- カラーチャートの面が均等に照らされるよう、地面や付近にある物からの反射光が当たらないように注意します。
- 太陽光の光源は遥か遠くにあるので、カラーチャート面に対し光が均等に当たらないということに気を使う必要はありませんが、電球の場合は光源が近いので、逆二乗の法則により、カラーチャートの傾き次第では光が均等に当たらない可能性が増えます。均等に光が当たるようにカラーチャート面を光源に向けるようにしますが、グレアが出ないようにも注意します。
- 背景もグレアを起こさないよう反射光のない背景を選びます。コンクリート面や黒い布などが適当な背景です。白い紙は不適切です。
- ピントに注意して撮影します。DCPを作成するソフトはほこりや傷を見極めて、それらを除外するように設計されているので、ピンボケや手振れに注意します。電球光での撮影には三脚を使用します。
- カラーチャートがフレームの中心から全体の1/3内、それ以上でもそれ以下でもありません、に収まるよう位置取りします。そうすることで光学的口径食を最小限に留めることが出来ます。
- カメラレンズから全てのフィルターを外します。
- 光学的口径食を抑えるため絞りはf/5.6～f/8にセットします。
- ISO値はカメラが有する最も低いもの、典型的には100を使います。StdAの写真を撮る場合は、ISO値が800を超えないようにします-三脚を使った撮影が望まれます。ISO値100、絞りf/8で、昼光での撮影なら露光時間は普通1/500s、電球光の下ならば1～5sでしょう。
- raw形式で撮影します（カメラが撮影できる最大の大きさのrawで撮影します、s-rawやその他の大きさではありません）。
- rawファイルに影響するようなカメラの設定、例えばLENR、などは全てオフにします。
- 露出ブラケットの使用に問題はありません、ブラケット撮影の中からクリッピングのないベストな露出で撮影された画像を選べるので、むしろ奨められます。例えば、-1EV/0EV/+1EVで3枚の撮影を行います。
- 画像の名前変更、或いは説明をして下さいー例えば、単にDSC1234.DNGという名前では、私たちには何の画像か分かりません。名前を“カメラのメーカーとその機種名　撮影環境.拡張子”という形に変更して下さい、例えば“NIKON
  D810　昼光+2EV.nef”というように。1枚以上の写真をアップロードする場合は、それぞれの違いを教えて下さい。また、どこで撮影を行ったのかも教えて下さい、例えば“マーシャル諸島のビキニ環礁”などと。そして、撮影に使用したカラーチャートの製造日、或いは少なくともそれを購入した年を教えて下さい。[ExifTool](https://exiftool.org/)を使用してファイルの名前を自動的に変更するには初めに以下の様にします：
    
  `exiftool '-FileName<${make}_${model}_iso${iso}_f${aperture}_%c.%le' dir`
- 上記の説明を今一度読んで、アップロードする前にそれらの写真が条件に沿っているか確かめて下さい。
- GitHubの[RawTherapee GitHub
  page](https://github.com/Beep6581/RawTherapee/issues/new)を開き、貴方が撮影したraw画像を[Filebin](https://filebin.net/)にアップロードし、そのリンクをGitHubの新たな懸案に貼り付けて下さい。私たちが必要なのはそのraw画像だけで、既存のDCPではありませんー私たちがそれを作成するからです。ブラケットで撮影した場合は、それら全てをアップロードして下さい。その中からベストショットを選びます。

自分用に特定の光環境でカラーチャートを撮影  

- 上記で説明したように、カラーチャートをフレームの1/3内で、絞りf/8、ISO100で、ピンボケや手振れのないように撮影を行います。他の条件を満たす必要はありません。もしも、貴方があるイベントービジネス用のポートレート、不動産、森のパノラマシーン、或いは結婚式、で多くの写真を撮影するなら、イベントの直前、或いは直後にカラーチャートの撮影を1枚行います。

## DCPの作成

　DCPの作成方法は幾つかあります。最も単純な方法は、カラーチャートに付属しているソフトウェアを使う方法です。より質が高いオープンソースを選ぶなら、DCamProfを使います。

### X-Riteのソフトウェアを使ってDCPを作成する

　X-Rite ColorChecker
Passportのカラーチャートに付いてくるソフトウェアをインストールします（ソフトウェアはwineを使えばLinuxでも使えます、LinuxにAdobe
DNG
Converterをインストールする時と同じ手順を踏みます）。そのソフトウェアで撮影した画像を開きますが、サポートしているのはDNG形式の画像だけなので、前もって画像をDNG形式に変換します。後は説明通りに処理します。

### DCamProfを使ってDCPを作成する

　Anders
Torgerが作成した、DCamProfはカメラプロファイルの作成やカメラプロファイル、プロファイリングに関する作業を実行するための、フリーなオープンソースコマンドラインツールです。特に、ICCとDNG形式のプロファイルの作成が可能で、CC24や他のカラーチャートから質の高い滑らかなLUTプロファイルを作ることが出来ます。

　同プログラムのホームページに明確で詳しい機能説明がありますので、主たる情報源になるでしょう。RawPediaの説明は、プログラムをコンパイルする（WindowsやmacOSでは必要ではありませんが）過程を単に例示したものです。

- 　DCamProfのGitHubプロジェクトとドキュメント:
    
  <https://github.com/Beep6581/dcamprof>
- 　DcamProfのホームページ:
    
  <https://torger.se/anders/dcamprof.htm>

　システムがWindowsとmacOSのユーザーはDCamProfバイナリをダウンロードして起動します。Linuxユーザーの場合は、コンパイルが必要かもしれません。コンパイルする前に、必要なディペンデンシーを持っているかどうか確認して下さい：LCMS2とlibtiffのコンパイルは、DCamProfの最新バージョンをダウンロードしてソースコードを解凍することと同じくらい簡単です。その後、ターミナルからフォルダーに行き、“make”と書き込むだけです。

　DCamProfを使って作成する場合は、ArgyllCMSもインストールしておく必要があります。このアプリケーションの一部の機能を使うからです。以下に示したコード例では、機能名の前に“argyll”が付いていますが、必ずしも貴方のシステムではそうでないかもしれません。例えば、GentooとSabayonでは、”scanin“ツールの実行ファイルは”argyll-scanin“となっていますが、Ubuntuでは単に”scanin“となっていますので、それぞれに従って下さい。

　2枚のColorChecker
Passportの画像から2次元光源のDCPプロファイルを作成するためには：

1.  カラーチャートの写真を2種類、前述の説明に従って撮影します。
2.  それぞれの画像に対し次のことを行います：
      
    最新バージョンのRawTherapeeでその画像を開きます

    ニュートラルプロファイルを適用します

    茶色のパッチが左上隅、黒いパッチが右下隅に来るよう画像を回転させます

    コーナーマーカーの所で切り抜きます

    カラーマネジメント機能の入力プロファイルの最下段にある“参照画像を保存”というボタンを押します。別ウィンドウが表示されるので、右下の“ホワイトバランスを適用”というボックスに✔が入っていないことを確認します。この画像を“daylight.tif”、もう一方の画像は”tungsten.tif”という名前で、コンパイルした“dcamprof”の実行ファイルが入っているフォルダーに保存します
3.  コンパイルした“dcamprof”の実行ファイルが入っているフォルダーを開き、実行します:

<!-- -->

    argyll-scanin -v -dipn tungsten.tif /usr/share/argyllcms/ref/ColorChecker.cht data-examples/cc24_ref.cie tungsten-diag.tif
    argyll-scanin -v -dipn daylight.tif /usr/share/argyllcms/ref/ColorChecker.cht data-examples/cc24_ref.cie daylight-diag.tif
    ./dcamprof make-profile -i StdA tungsten.ti3 tungsten.json
    ./dcamprof make-profile -i D50 -C daylight.ti3 daylight.json
    ./dcamprof make-dcp -n "Pentax K10D" -d "Pentax K10D" -c "RawTherapee CC0" -t acr -o neutral tungsten.json daylight.json "PENTAX K10D.dcp"

　ここで非常に重要なことは、DCPを作る作業中、tangsten.jsonを最初に、次にdaylight.jasonを特定します。

　この例で、出力プロファイルの名前は、`PENTAX K10D.dcp`です。RawTherapeeが認識できるものと全く同一の名前を使用します。RawTherapeeでStdA或いはD50/D65画像を開き、“画像の情報”ボタン（ショートカットキー“i”）を押せば、RawTherapeeが認識できる貴方のカメラ名が見られます。

　貴方が作成した2次元光源-DCPプロファイルを使う準備が整いました。

　貴方が作成した新しいDCPを自動的にRawTherapeeが適用するようにするには、そのDCPフィルを`dcpprofiles`フォルダーに入れます。このフォルダーはシステムがWindowsであれば普通はRawTherapeeのインストールフォルダーの中にあります、LinuxとmacOSの場合は、`/usr/share/rawtherapee/dcpprofiles/`の中です。別の方法として、貴方の作成したDCPを使うrawファイルに関する新しいデフォルトpp3で適用することも可能です。

　DCamProfはデフォルトで、精度より滑らかさを優先させるため、LUTを滑らかにするように作られています。このことにより、そのプロファイルを汎用目的のために十分使えるようにしています。望めば滑らかさに関するパラメータを手動で調整することも出来ますが、通常その必要はないでしょう。更なる情報を知りたい場合は、DCamProfの説明書を参照して下さい。
