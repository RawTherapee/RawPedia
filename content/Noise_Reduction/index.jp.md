---
title: Noise Reduction jp
contributors:
  - Yz2house
---

<div class="pagetitle">

ノイズ低減

</div>
## イントロダクション

<figure>
<img src="/images/Noise-cactus-0-ba.png" title="Noise-cactus-0-ba.png" />
<figcaption>Noise-cactus-0-ba.png</figcaption>
</figure>

　写真撮影は露光中にカメラの中の媒体に当たる光を記録することが出発点となります。典型的な媒体はフィルム或いはデジタルセンサーです。しかし、媒体が光から受けるシグナルと媒体が記録するシグナルは全く同じものではなく、その違いのためノイズが発生します。フィルム及びデジタル写真撮影はノイズ（フィルムの場合は“グレイン“と呼ばれます）の影響を受けますが、ノイズには特定の要因や媒体によって様々な種類があります。

　ノイズを効果的に軽減するために、どの様なノイズが存在するのか、またどの様な場合に発生するのかを知っておくことは有益です。ノイズに関しては、RawTherapeeの開発者の一人、エンリコ・フェルミ研究所の物理学教授、Emil
J Martinec氏による詳細説明があります：[Noise, Dynamic Range and Bit
Depth in Digital SLRs](http://rawtherapee.com/mirror/noise/)

　光はフォトンと呼ばれるエネルギーの集まりで構成されています。一方、\[<https://ja.wikipedia.org/wiki/CMOS%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%BB%E3%83%B3%E3%82%B5>　デジタルセンサー\]は何百万もの*フォトサイト*（センサーの要素という意味で、センセルともいいます）で構成されています。各フォトサイトはフォトンからの一定範囲の信号を記録することが出来ます‐それが非常に少ないとフォトサイトは何も記録しません、また、非常に多いと純白（完全な露出オーバー）に“クリップ（飽和）”します。バケツで雨水を集めることと似ています‐雨が降らなければバケツは空のままですが、豪雨になればバケツから水が溢れてしまいます。

　ここまでの説明で“ピクセル”という用語が出ていないことに留意して下さい‐複数のフォトサイトから送られてくる光の情報が、この後[デモザイクと](demosaicing/jp)呼ばれる処理を通して一つのピクセルに統合されるのです。しかし、関連情報の中には、“フォトサイト”を“ピクセル”と書いているものがあります。

　イメージセンサーの物理的な感度は一定ですが、撮影者は記録された信号を増幅するように設定することが出来ます。ご存知\[<https://ja.wikipedia.org/wiki/ISO%E6%84%9F%E5%BA%A6>　ISO\]の設定です。前述したように、センサーに記録されるシグナルは完全なものではないので、高いISO値を設定すると目標とするシグナルだけでなく、ノイズも増幅されます。どのISO値であってもセンサーにはノイズの影響が出ますが、高いISO値ほどノイズが目立つようになります。

　ノイズの種類に応じてそれを処理する機能も異なります：

- 　ノイズ低減はフォトンの\[<https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E9%9B%91%E9%9F%B3>　ショットノイズ\]
  （ガウスノイズとポアソンノイズ）及びフィルムグレインを処理するのに最も有効な機能です。
- 　リードノイズとサーマルノイズに関しては[ダークフレームによる](dark_frame/jp)対応が最適です。
- 　ソルト＆ペッパーノイズ（予想に反した黒や白のピクセルが現れる）には[インパルスノイズ低減を](impulse_noise_reduction/jp)使います。
- 　ホット及びバッドピクセルは、[ホット／バッドピクセルフィルターで](preprocessing/jp#ホット／バッドピクセルフィルター)処理します。
- 　パターンノイズ（反復性、異方性）は[ラインノイズフィルターで](preprocessing/jp#ラインノイズフィルター)処理するのが最適です。また、パターンノイズ（デスクリーン）はRawTherapeeがプラグインされたGIMPでもG’MICのフーリエ変換を使って補正できます。

　原因が何であるにせよ、ノイズは逸脱した色の斑点‐“色ノイズ”と、異なる明るさの斑点‐“輝度ノイズ”として現れます。

1.  　色ノイズはデジタル画像特有の産物で、一般的には醜いので、常に除去したいノイズです。
2.  　一方、輝度ノイズはフィルムグレインに似ているので、それが魅力的表現であるとする場合もあり、色ノイズの様に常に除去したいものではありません。

<div align="center">

<File:Noise-wall.png%7C試験的にISO6400で撮影したノイズの多い画像>
<File:Noise-wall-demosaic-amaze.png%7CAmaZEでデモザイク処理、小さなメイズパターンに似たノイズが発生>
<File:Noise-wall-demosaic-lmmse.png%7CLMMSEでデモザイク処理、メイズパターンに似たノイズの発生を避け、詳細も維持>
<File:Noise-wall-luminance100-chrominance-off.png%7Cこれが色ノイズ。はっきり見せるため輝度ノイズを軽減してある。色が滑らかなはずの壁に逸脱した色の斑点がある>。
<File:Noise-wall-luminance100-chrominance-on.png%7Cノイズ低減を使えば色の斑点が軽減できる>
<File:Noise-wall-chrominance.png%7Cこれが輝度ノイズ。はっきり見せるため色ノイズを軽減してある>。
<File:Noise-wall-luminance-tweaked-chrominance-on-median-off.png%7C色ノイズと輝度ノイズの両方を軽減した画像>
<File:Noise-wall-luminance-tweaked-chrominance-on-zoom-median-off.png%7Cノイズの軽減後に小さいピクセルサイズのアーティファクトが残っている>
<File:Noise-wall-luminance-tweaked-chrominance-on-zoom-median-on.png%7Cメディアンフィルターを使えばこのアーティファクトも軽減できる>

</div>

　ユーザーが求めるノイズ低減効果は、その人によって違います。完全なノイズ除去による、滑らかな画像が好きな人もいれば、フィルム調の質感を残したいと思う人もいます。RawTherapee
の*ノイズ低減*機能は、これらのニーズに応えるべく、画像の細部を保ちながらノイズを除去します。\[<https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A7%E3%83%BC%E3%83%96%E3%83%AC%E3%83%83%E3%83%88%E5%A4%89%E6%8F%9B>　ウェーブレット変換\]と\[<https://ja.wikipedia.org/wiki/%E3%83%95%E3%83%BC%E3%83%AA%E3%82%A8%E5%A4%89%E6%8F%9B>　フーリエ変換\]を駆使して調整しますが、どの様に仕上げるかは、貴方次第です。効果的な調整を行うための説明が以下にあります。

## この機能の扱い方

　この項ではノイズを取り去る処理の詳細を順に説明します。

1.  　まず適用するデモザイクの方式が最適なものかどうか確認します。RawTherapeeを一般的な画像に使うのであれば、AMaZEの適用を奨めますが、ノイズが非常に多い高ISOの画像に関しては、LMMSE、或いはIGVの適用を奨めます。AMaZEでは小さいメイズ模様に似たアーティファクトが発生することがあるからです。LMMSEやIGVは、この問題を避けながら、画像の詳細を保つよう設計されています。
2.  　シャープニング機能で細部がシャープになっていないことを確認します、何故ならノイズの多い画像の細部は精度に欠けるからです。[ディテールレベルのコントラスト](contrast_by_detail_levels/jp)機能や[ウェーブレット](wavelets/jp)機能を使っている場合は、ノイズを増幅させないため、最も詳細なレベルの、或いは次のレベルも含めて、スライダーの値を0にします。
3.  　編集画像を100％或いはそれ以上に拡大し、鋭く焦点の合っているところと、焦点の合っていないところの両方を同時に見ることの出来る画像部分を捜します。処理を行った際にノイズの軽減効果をその部分で確認するためです。
4.  　ソルト＆ペッパーノイズ（黒、或いは白いピクセル）があれば、[ホット／バッドピクセルフィルターを](preprocessing/jp#前処理)有効にします。
5.  　ノイズ低減機能を有効にします。色ノイズは自動で軽減されるので、通常、再調整の必要はありません。この時点で、画像にはフィルム写真のようなざらつき感だけが残っていると思います。ここまでの仕上がりで満足ならば、ノイズ低減処理は終了したことになりますが、更に調整が必要ならば以下に進んで下さい。
6.  　輝度ノイズを除去するために、輝度　細部の復元スライダーを0にセットしてから、ノイズが消えて画像が滑らかになるまで輝度スライダーを動かします。
7.  　輝度　細部の復元スライダーを使って細部の復元を行います。
8.  　ノイズ低減処理を行っても小さなアーティファクトが残っている場合があります。その場合は、メディアンフィルターを使って取り除きます。
9.  　一般的に、シャープニング機能とノイズ低減機能を併用することは奨めませんが、バージョン5.5以降のRawTherapeeには[シャープニング](sharpening/jp)機能の中に“コントラストのしきい値”が備わっているので、均一な画質や滑らかな画質部分でノイズが増幅するのを避けながら細部だけをシャープにする調整が可能です。

<div align="center">

<File:Noise-cactus-1-amaze.png%7Cノイズの多い画像>
<File:Noise-cactus-2-lmmse.png%7Cデモザイクの方式をLMMSEに変えたことで小さなメイズ模様は消えたが、ソルト＆ペッパーノイズが目立つ>
<File:Noise-cactus-3-pixelfilter.png>\|[ホット／バッドピクセルフィルターを](preprocessing/jp#前処理)有効にし、ソルト＆ペッパーノイズを消した
<File:Noise-cactus-4-nr-chroma.png%7Cノイズ低減機能で自動的に色ノイズが消えフィルム調の画質になった>
<File:Noise-cactus-5-nr-luminance.png%7C輝度フィルターで輝度ノイズが消え画質が滑らかになった>
<File:Noise-cactus-6-nr-detailrecovery.png%7C輝度>　細部の復元スライダーで細部が回復
<File:Noise-cactus-7-nr-median.png%7Cメディアンフィルターで残るアーティファクトを取り除く>
<File:Noise-cactus-8-sharpen.png%7Cコントラストのしきい値を使い、滑らかであるべき部分でノイズが増幅するのを避けながら画像全体のシャープネスを回復>

</div>

## インターフェイス

### 全般

　RGBとLabモードを切り替える時は、細部がしっかりした彩度の高い大きな部分、例えばTシャツの色模様や花びらなど、を注意深く確認してみて下さい。

　以下の画像は様々な種類のノイズ低減機能によって得られる効果を例示したものです、違いを見せるため強く調整しています。元画像に（非常に低い）低周波ノイズはありませんが、機能の効果（及びその副作用）を明確に見せるため、敢えて低周波ノイズのない画像を使っています。

<div align="center">

<File:Noise-handkerchief-1-off.png%7Cノイズの多い画像、効果の程を見せるため、意図的に細部の復元は0、色度を高く設定>
<File:Noise-handkerchief-2-luminance-lab-conservative.png%7CL*a*b*色空間における輝度ノイズ低減の効果‐控えめな適用>
<File:Noise-handkerchief-3-luminance-lab-aggressive.png%7CL*a*b*色空間における輝度ノイズ低減の効果‐積極的な適用>
<File:Noise-handkerchief-4-luminance-rgb-conservative.png%7CRGB色空間における輝度ノイズ低減の効果‐控えめな適用>
<File:Noise-handkerchief-5-luminance-rgb-aggressive.png%7CRGB色空間における輝度ノイズ低減の効果‐積極的な適用>
<File:Noise-handkerchief-6-chrominance-lab-conservative.png%7CL*a*b*色空間における色ノイズ低減の効果‐控えめな適用>
<File:Noise-handkerchief-7-chrominance-lab-aggressive.png%7CL*a*b*色空間における色ノイズ低減の効果‐積極的な適用、一つの色相が別な色相と隣接している部分で、色が異なる色の部分に染み出していることが分かる‐例えば、ネイビーブルーがシアンに、グリーンが濁ったレッドに、濁ったレッドが深紅色に染み出している>
<File:Noise-handkerchief-8-chrominance-rgb-conservative.png%7CRGB色空間における色ノイズ低減の効果‐控えめな適用>
<File:Noise-handkerchief-9-chrominance-rgb-aggressive.png%7CRGB色空間における色ノイズ低減の効果‐積極的な適用、低周波の詳細が失われている>

</div>

### 色空間

　ノイズ低減機能はL\*a\*b\*色空間、RGB色空間のどちらでも使えます。

　L\*a\*b\*色空間で作業する場合、輝度に関してはL\*チャンネルが、色に関しては、a\*とb\*チャンネルがノイズ低減に使われます。

　作業色空間がRGBの場合、CIE
XYZ色空間のYが輝度ノイズの低減に使われ、（X-Y）と（Y-Z）が色ノイズ低減に使われます。

### モード

　一般的なノイズ低減には2つの“モード”が用意されていて、高周波ノイズだけを処理するか、低周波ノイズだけを処理するか選べます。低周波ノイズは
広い領域に見られる斑点で、高周波ノイズは反対に狭い領域で見られる小さな斑点です。

1.  　控えめな適用‐非常に低い周波数のノイズ以外は全て軽減するモードで、色の詳細情報が積極的な適用モードより保たれますが、非常に大きな斑点は除去できません。通常使用のモードです。
2.  積極的な適用-非常に低い周波数のノイズも除去しますが、高い周波数のノイズ除去は更に強くなります。非常にノイズの多い画像だけに適用するモードです。

### ガンマ

　ガンマは諧調に応じてノイズ低減の強さを変えるスライダーです。ガンマの値を小さく取るとシャドウ部分でのノイズ低減作用が強まり、高く取ると明るい部分だけにノイズ低減が作用します。

### 輝度ノイズ

<figure>
<img src="/images/Rt_nr_luminancecurve_books.jpg"
title="Rt_nr_luminancecurve_books.jpg" />
<figcaption>Rt_nr_luminancecurve_books.jpg</figcaption>
</figure>

　“輝度ノイズの調整法”で、輝度ノイズの低減をスライダーで行うか、カーブで行うか選びます。

　“輝度”スライダーによる調整は、カーブの振幅を調整することと同じです‐両方ともノイズ低減の効果の強弱に関わります。但し、カーブによる調整には、ピクセルの輝度に応じた調整という、スライダーにない利点があります‐例えば、シャドウ部分の輝度ノイズ低減を強くして、ハイライト部分では作用しないようにすることです。

　“輝度　細部の復元”スライダーは、ノイズを再び増幅させることなく、画像の詳細を回復させる機能ですが、設定値が高すぎるとその限りではありません。

### 色ノイズ

#### 方式

　色ノイズ低減の機能は３つ、或いは4つのモードから選んで使います。モードの選択は“環境設定→パフォーマンスとクオリティ→ノイズ低減”で行います：

　ツールモード – 標準:

- 手動
- 自動（全体）
- プレビュー

　ツールモード – 高度:

- 手動
- 自動（全体）
- 自動（マルチゾーン）
- プレビュー（マルチゾーン）

#### プレビュー画像のノイズ

　
“プレビュー画像のノイズ”は、処理された画像の色ノイズの推定値を示しています。

- 平均値:　全色チャンネルで見た色ノイズの推定平均値
- 最大値: 全色チャンネルで見た色ノイズの推定最大値

#### モード：手動

　3つのスライダーと1つのカーブの調整が画像全体の色ノイズに作用します。調整を手動で行います。

#### マスター

　色ノイズ低減の強さを調整します。レッド‐グリーンとブルー‐イエローの設定値に対し独立的なオフセットとして機能します。例えば、マスター=50、レッド‐グリーン=‐50、ブルー‐イエロー=‐50に設定されると、効果は0になります。

#### レッド‐グリーン

　レッド‐グリーンチャンネル（L\*a\*b\*色空間のa\*チャンネル）の色ノイズを軽減／増幅します。

#### ブルー‐イエロー

　ブルー‐イエローチャンネル（L\*a\*b\*色空間のb\*チャンネル）の色ノイズを軽減／増幅します。

#### 色ノイズ低減カーブ

　色ノイズの低減カーブは、ピクセルの色度に応じて色ノイズ低減の強さを調整する機能です‐例えば、色度の低い部分では強く、色度の高い部分では弱く、ノイズ低減の作用を調節出来ます。このカーブは“マスター”、“レッド‐グリーン”、“ブルー‐イエロー”スライダーによる作用を、スライダー値にカーブの縦座標値を乗算することで変化させます。例えば、マスタースライダーが30に設定されている時に、カーブの縦座標が中間の位置にあれば、効果の強さは45と同等になります。次のような場合に使用すると便利です。“自動（全体）”モードでグレーやくすんだ色の部分のノイズを軽減しようとすると、効果が弱過ぎることがしばしばあります。これはこのモードがノイズを平均的に処理するからです。グレーな部分では色ノイズが目立つので不快な印象が残りますが、色度の高い部分は同じ低減効果でも、ノイズが目立ち難いので許容できる印象となります。

#### 自動（全体）

　このアルゴリズムは画像を幾つかのセルに分割し、各セルに対して次の演算を行います：

- レッド‐グリーンチャンネルとブルー‐イエローチャンネルのノイズの平均値
- 上記チャンネルのノイズの最大値

#### プレビュー画像のノイズ

　このモードは画像が100％以上に拡大されている時にしか使えません。プレビュー画面に表示されている画像部分でノイズを解析し、ノイズ低減の演算を行います：

- レッド‐グリーンチャンネルとブルー‐イエローチャンネルのノイズの平均値
- 上記チャンネルのノイズの最大値

　表示されている画像を動かすと、マスター、レッド‐グリーン、ブルー‐イエロー、及び“プレビュー画像のノイズ”の値が更新されます。

　従って、現在計算された値を維持したい場合は、モードを“手動”に切り替える必要があります。切り替えが行われないと、画像を動かした時、或いはプロファイルを他の画像にコピーする時に値が再計算されてしまいます。

#### 自動マルチゾーン

　この方式は環境設定でツールのモードを“高度”に設定しないと使えません。

　これは画像全体が非常に大きい場合のノイズ低減に使います。

　また、効果は保存画像だけに反映され、プレビュー画像を拡大しても確認出来ません。

　画像がタイルに分割されます。タイルは縦横約500～800ピクセルの大きさです。画像の大きさに応じて“環境設定→パフォーマンス＆クオリティ→タイルの数”で12～120枚に設定します。各タイル別々に3つの値、レッド‐グリーン、ブルー‐イエローのノイズ、ノイズの最大値、が算出されるので、最大で120x3の固有値が得られます。隣接するタイルの値が大きく異なると、アーティファクトが発生し易くなります。その場合は、それらタイルの合わせ目をブレンドして滑らかにすることができます。環境設定→パフォーマンス＆クオリティ→自動（多分割スムージング）で設定します：

- なし:　各タイルの値が完全に独立した状態です
- 低:　隣接するタイルの処理の一部が多少考慮されます
- 高:　 隣接するタイルの処理の一部がかなり考慮されます
- 最大:　全タイルの平均値が使われます。“自動（全体）”モードに似た作用をしますが、9個のセルの平均値の代わりにタイル（12～120枚）の平均値を使います。

#### プレビューマルチゾーン

　この方式も環境設定でツールのモードを“高度”に設定しないと使えません。

　“プレビュー”モードと同じですが、“プレビュー画像のノイズ”で得られる情報を助けに“自動マルチゾーン”を使った場合の効果を推定できます（自動マルチゾーンモードはプレビューで画像を確認できないので）。

　“プレビュー画像のノイズ”の平均値＝x、最大値＝yの情報の下に表示される2行が以下の情報を提供します：

- 1行目はタイルサイズと（ピクセル）、元画像におけるタイルの位置を座標で表示します。
- 2行目はプレビュー画像のサイズと（ピクセル）、プレビュー画像の位置を座標で示します。

プレビュー画像の大きさは拡大率や表示ウィンドウの大きさで変化します。
タイルの中心位置やサイズはプレビュー画像を動かしたり、拡大率を変えたりして調整します。

### メディアン

<img src="/images/Rt_nr_median_books.jpg" title="Rt_nr_median_books.jpg"
width="600" alt="Rt_nr_median_books.jpg" />
![](Rt_nr_median_zoom_books.jpg "Rt_nr_median_zoom_books.jpg")

　このフィルターでノイズ低減処理の後に残った小さく尖った形のアーティファクトを取り除きます。

#### メディアンの種類

　\[<https://en.wikipedia.org/wiki/Median_filter>　メディアンフィルター\]　（英語）は隣接するピクセルの中間値を目標とするピクセルの値と置き換える働きをします。隣接するピクセルの集まりは”ウィンドウ”と呼ぶもので、このウィンドウがピクセルごとに画像全体をスライドしてアーティファクトを取り除いて行きます。ウィンドウのサイズは以下から選びます。サイズが大きいほど処理時間が長くなります。

使用出来るウィンドウのサイズは:

- 3x3ソフト：　1ピクセル範囲で5ピクセルを処理

  
○●○

●●●

○●○

- 3x3：　1ピクセル範囲で9ピクセルを処理

  
●●●

●●●

●●●

- 5x5ソフト：　2ピクセル範囲で13ピクセルを処理

  
○○●○○

○●●●○

●●●●●

○●●●○

○○●○○

- 5x5：　2ピクセル範囲で25ピクセルを処理

  
●●●●●

●●●●●

●●●●●

●●●●●

●●●●●

- 7x7：　3ピクセル範囲で49ピクセルを処理

  
●●●●●●●

●●●●●●●

●●●●●●●

●●●●●●●

●●●●●●●

●●●●●●●

●●●●●●●

- 9x9：　4ピクセル範囲で81ピクセルを処理

  
●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

●●●●●●●●●

　小さいウィンドウを使った機能の繰り返しの方が、大きいウィンドウを一回だけ使った時より、効果が高い場合もあります。

#### メディアンの方式

　使用できる方式は5つあります：

- 輝度ノイズだけ：作業色空間はL\*a\*b\*ですが、L\*チャンネルだけに作用します
- 色ノイズだけ：作業色空間はL\*a\*b\*ですが、a\*チャンネルとb\*チャンネルだけに作用します
- L\*（少ない）とa\*とb\*（普通）の加重平均：L\*a\*b\*の全てのチャンネルに作用しますが、L\*チャンネルに対しては弱めに作用します
- L\*a\*b\*：全てのチャンネルに対し同じ強さで作用します
- RGB：作業色空間がRGBのモードです。このモードが使用できるウィンドウのサイズは3x3ソフト、3x3
  、5x5に制限されます

　“輝度のみ”と“Lab”モードを使った場合、メディアンフィルターは、ノイズ低減行程の中のウェーブレット変換が行われた後に使われます。“RGB”モードの場合は、ノイズ低減の最終工程で使われます。

　メディアンフィルターの使用目的は、美的な理由から、隣接するピクセルに非常に乖離したものがある時、それを除去することにありますが、他の目的もあります。その一つは、画像をJPEGやPNGに圧縮して保存する際に画像ファイルのサイズを減らすことです。メディアンフィルターは、保存の際の画像圧縮で、どの道失われる小さな変異を予め取り除きます。これら小さな変異は印刷時には恐らく見えないものです。しかし、フィルターを使ってこれらを取り除いておけば、画像サイズを40％節約できる（JPEGの圧縮率を92、\[<https://en.wikipedia.org/wiki/Chroma_subsampli>　クロマサブサンプリング\]　（英語）を“バランス”に設定した画像でテスト済み）こともありますので、ファイルサイズが気になるユーザーは一度試してみて下さい。

　最後に、“色ノイズのみ”の方式は、自動で行われる色ノイズ低減の計算を補完する方式考えればいいでしょう。自動計算で得られた中の大きく外れた値を減らすことで、計算値を緩和し、詳細な色情報が失われ過ぎないようにします。
